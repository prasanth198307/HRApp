/Users/prasanthdusi/HRApp/dist/index.cjs:78
		`;await r.execute(v`CREATE SCHEMA IF NOT EXISTS ${v.identifier(i)}`),await r.execute(s);let c=(await r.all(v`select id, hash, created_at from ${v.identifier(i)}.${v.identifier(a)} order by created_at desc limit 1`))[0];await r.transaction(async l=>{for await(let u of e)if(!c||Number(c.created_at)<u.folderMillis){for(let p of u.sql)await l.execute(v.raw(p));await l.execute(v`insert into ${v.identifier(i)}.${v.identifier(a)} ("hash", "created_at") values(${u.hash}, ${u.folderMillis})`)}})}escapeName(e){return`"${e}"`}escapeParam(e){return`$${e+1}`}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildWithCTE(e){if(!e?.length)return;let r=[v`with `];for(let[n,a]of e.entries())r.push(v`${v.identifier(a._.alias)} as (${a._.sql})`),n<e.length-1&&r.push(v`, `);return r.push(v` `),v.join(r)}buildDeleteQuery({table:e,where:r,returning:n,withList:a}){let i=this.buildWithCTE(a),s=n?v` returning ${this.buildSelection(n,{isSingleTable:!0})}`:void 0,o=r?v` where ${r}`:void 0;return v`${i}delete from ${e}${o}${s}`}buildUpdateSet(e,r){let n=e[L.Symbol.Columns],a=Object.keys(n).filter(s=>r[s]!==void 0||n[s]?.onUpdateFn!==void 0),i=a.length;return v.join(a.flatMap((s,o)=>{let c=n[s],l=r[s]??v.param(c.onUpdateFn(),c),u=v`${v.identifier(this.casing.getColumnCasing(c))} = ${l}`;return o<i-1?[u,v.raw(", ")]:[u]}))}buildUpdateQuery({table:e,set:r,where:n,returning:a,withList:i,from:s,joins:o}){let c=this.buildWithCTE(i),l=e[mt.Symbol.Name],u=e[mt.Symbol.Schema],p=e[mt.Symbol.OriginalName],d=l===p?void 0:l,f=v`${u?v`${v.identifier(u)}.`:void 0}${v.identifier(p)}${d&&v` ${v.identifier(d)}`}`,m=this.buildUpdateSet(e,r),h=s&&v.join([v.raw(" from "),this.buildFromTable(s)]),b=this.buildJoins(o),w=a?v` returning ${this.buildSelection(a,{isSingleTable:!s})}`:void 0,_=n?v` where ${n}`:void 0;return v`${c}update ${f} set ${m}${h}${b}${_}${w}`}buildSelection(e,{isSingleTable:r=!1}={}){let n=e.length,a=e.flatMap(({field:i},s)=>{let o=[];if(S(i,B.Aliased)&&i.isSelectionField)o.push(v.identifier(i.fieldAlias));else if(S(i,B.Aliased)||S(i,B)){let c=S(i,B.Aliased)?i.sql:i;r?o.push(new B(c.queryChunks.map(l=>S(l,j)?v.identifier(this.casing.getColumnCasing(l)):l))):o.push(c),S(i,B.Aliased)&&o.push(v` as ${v.identifier(i.fieldAlias)}`)}else S(i,ye)&&(r?o.push(v.identifier(this.casing.getColumnCasing(i))):o.push(i));return s<n-1&&o.push(v`, `),o});return v.join(a)}buildJoins(e){if(!e||e.length===0)return;let r=[];for(let[n,a]of e.entries()){n===0&&r.push(v` `);let i=a.table,s=a.lateral?v` lateral`:void 0;if(S(i,mt)){let o=i[mt.Symbol.Name],c=i[mt.Symbol.Schema],l=i[mt.Symbol.OriginalName],u=o===l?void 0:a.alias;r.push(v`${v.raw(a.joinType)} join${s} ${c?v`${v.identifier(c)}.`:void 0}${v.identifier(l)}${u&&v` ${v.identifier(u)}`} on ${a.on}`)}else if(S(i,Rt)){let o=i[Oe].name,c=i[Oe].schema,l=i[Oe].originalName,u=o===l?void 0:a.alias;r.push(v`${v.raw(a.joinType)} join${s} ${c?v`${v.identifier(c)}.`:void 0}${v.identifier(l)}${u&&v` ${v.identifier(u)}`} on ${a.on}`)}else r.push(v`${v.raw(a.joinType)} join${s} ${i} on ${a.on}`);n<e.length-1&&r.push(v` `)}return v.join(r)}buildFromTable(e){if(S(e,L)&&e[L.Symbol.OriginalName]!==e[L.Symbol.Name]){let r=v`${v.identifier(e[L.Symbol.OriginalName])}`;return e[L.Symbol.Schema]&&(r=v`${v.identifier(e[L.Symbol.Schema])}.${r}`),v`${r} ${v.identifier(e[L.Symbol.Name])}`}return e}buildSelectQuery({withList:e,fields:r,fieldsFlat:n,where:a,having:i,table:s,joins:o,orderBy:c,groupBy:l,limit:u,offset:p,lockingClause:d,distinct:f,setOperators:m}){let h=n??lr(r);for(let de of h)if(S(de.field,ye)&&Qt(de.field.table)!==(S(s,nt)?s._.alias:S(s,Pi)?s[Oe].name:S(s,B)?void 0:Qt(s))&&!(le=>o?.some(({alias:ue})=>ue===(le[L.Symbol.IsAlias]?Qt(le):le[L.Symbol.BaseName])))(de.field.table)){let le=Qt(de.field.table);throw new Error(`Your "${de.path.join("->")}" field references a column "${le}"."${de.field.name}", but the table "${le}" is not part of the query! Did you forget to join it?`)}let b=!o||o.length===0,w=this.buildWithCTE(e),_;f&&(_=f===!0?v` distinct`:v` distinct on (${v.join(f.on,v`, `)})`);let E=this.buildSelection(h,{isSingleTable:b}),O=this.buildFromTable(s),R=this.buildJoins(o),C=a?v` where ${a}`:void 0,P=i?v` having ${i}`:void 0,q;c&&c.length>0&&(q=v` order by ${v.join(c,v`, `)}`);let W;l&&l.length>0&&(W=v` group by ${v.join(l,v`, `)}`);let Ie=typeof u=="object"||typeof u=="number"&&u>=0?v` limit ${u}`:void 0,Le=p?v` offset ${p}`:void 0,Ne=v.empty();if(d){let de=v` for ${v.raw(d.strength)}`;d.config.of&&de.append(v` of ${v.join(Array.isArray(d.config.of)?d.config.of:[d.config.of],v`, `)}`),d.config.noWait?de.append(v` no wait`):d.config.skipLocked&&de.append(v` skip locked`),Ne.append(de)}let re=v`${w}select${_} ${E} from ${O}${R}${C}${W}${P}${q}${Ie}${Le}${Ne}`;return m.length>0?this.buildSetOperations(re,m):re}buildSetOperations(e,r){let[n,...a]=r;if(!n)throw new Error("Cannot pass undefined values to any set operator");return a.length===0?this.buildSetOperationQuery({leftSelect:e,setOperator:n}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:n}),a)}buildSetOperationQuery({leftSelect:e,setOperator:{type:r,isAll:n,rightSelect:a,limit:i,orderBy:s,offset:o}}){let c=v`(${e.getSQL()}) `,l=v`(${a.getSQL()})`,u;if(s&&s.length>0){let m=[];for(let h of s)if(S(h,j))m.push(v.identifier(h.name));else if(S(h,B)){for(let b=0;b<h.queryChunks.length;b++){let w=h.queryChunks[b];S(w,j)&&(h.queryChunks[b]=v.identifier(w.name))}m.push(v`${h}`)}else m.push(v`${h}`);u=v` order by ${v.join(m,v`, `)} `}let p=typeof i=="object"||typeof i=="number"&&i>=0?v` limit ${i}`:void 0,d=v.raw(`${r} ${n?"all ":""}`),f=o?v` offset ${o}`:void 0;return v`${c}${d}${l}${u}${p}${f}`}buildInsertQuery({table:e,values:r,onConflict:n,returning:a,withList:i,select:s,overridingSystemValue_:o}){let c=[],l=e[L.Symbol.Columns],u=Object.entries(l).filter(([w,_])=>!_.shouldDisableInsert()),p=u.map(([,w])=>v.identifier(this.casing.getColumnCasing(w)));if(s){let w=r;S(w,B)?c.push(w):c.push(w.getSQL())}else{let w=r;c.push(v.raw("values "));for(let[_,E]of w.entries()){let O=[];for(let[R,C]of u){let P=E[R];if(P===void 0||S(P,Vt)&&P.value===void 0)if(C.defaultFn!==void 0){let q=C.defaultFn(),W=S(q,B)?q:v.param(q,C);O.push(W)}else if(!C.default&&C.onUpdateFn!==void 0){let q=C.onUpdateFn(),W=S(q,B)?q:v.param(q,C);O.push(W)}else O.push(v`default`);else O.push(P)}c.push(O),_<w.length-1&&c.push(v`, `)}}let d=this.buildWithCTE(i),f=v.join(c),m=a?v` returning ${this.buildSelection(a,{isSingleTable:!0})}`:void 0,h=n?v` on conflict ${n}`:void 0,b=o===!0?v`overriding system value `:void 0;return v`${d}insert into ${e} ${p} ${b}${f}${h}${m}`}buildRefreshMaterializedViewQuery({view:e,concurrently:r,withNoData:n}){let a=r?v` concurrently`:void 0,i=n?v` with no data`:void 0;return v`refresh materialized view${a} ${e}${i}`}prepareTyping(e){return S(e,_o)||S(e,wo)?"json":S(e,Eo)?"decimal":S(e,So)?"time":S(e,To)||S(e,Ao)?"timestamp":S(e,xo)||S(e,bo)?"date":S(e,Io)?"uuid":"none"}sqlToQuery(e,r){return e.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping,invokeSource:r})}buildRelationalQueryWithoutPK({fullSchema:e,schema:r,tableNamesMap:n,table:a,tableConfig:i,queryConfig:s,tableAlias:o,nestedQueryRelation:c,joinOn:l}){let u=[],p,d,f=[],m,h=[];if(s===!0)u=Object.entries(i.columns).map(([_,E])=>({dbKey:E.name,tsKey:_,field:Lr(E,o),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let w=Object.fromEntries(Object.entries(i.columns).map(([P,q])=>[P,Lr(q,o)]));if(s.where){let P=typeof s.where=="function"?s.where(w,zT()):s.where;m=P&&ho(P,o)}let _=[],E=[];if(s.columns){let P=!1;for(let[q,W]of Object.entries(s.columns))W!==void 0&&q in i.columns&&(!P&&W===!0&&(P=!0),E.push(q));E.length>0&&(E=P?E.filter(q=>s.columns?.[q]===!0):Object.keys(i.columns).filter(q=>!E.includes(q)))}else E=Object.keys(i.columns);for(let P of E){let q=i.columns[P];_.push({tsKey:P,value:q})}let O=[];s.with&&(O=Object.entries(s.with).filter(P=>!!P[1]).map(([P,q])=>({tsKey:P,queryConfig:q,relation:i.relations[P]})));let R;if(s.extras){R=typeof s.extras=="function"?s.extras(w,{sql:v}):s.extras;for(let[P,q]of Object.entries(R))_.push({tsKey:P,value:uh(q,o)})}for(let{tsKey:P,value:q}of _)u.push({dbKey:S(q,B.Aliased)?q.fieldAlias:i.columns[P].name,tsKey:P,field:S(q,ye)?Lr(q,o):q,relationTableTsKey:void 0,isJson:!1,selection:[]});let C=typeof s.orderBy=="function"?s.orderBy(w,MT()):s.orderBy??[];Array.isArray(C)||(C=[C]),f=C.map(P=>S(P,ye)?Lr(P,o):ho(P,o)),p=s.limit,d=s.offset;for(let{tsKey:P,queryConfig:q,relation:W}of O){let Ie=FT(r,n,W),Le=ba(W.referencedTable),Ne=n[Le],re=`${o}_${P}`,de=Ae(...Ie.fields.map((X,Ge)=>I(Lr(Ie.references[Ge],re),Lr(X,o)))),le=this.buildRelationalQueryWithoutPK({fullSchema:e,schema:r,tableNamesMap:n,table:e[Ne],tableConfig:r[Ne],queryConfig:S(W,An)?q===!0?{limit:1}:{...q,limit:1}:q,tableAlias:re,joinOn:de,nestedQueryRelation:W}),ue=v`${v.identifier(re)}.${v.identifier("data")}`.as(P);h.push({on:v`true`,table:new nt(le.sql,{},re),alias:re,joinType:"left",lateral:!0}),u.push({dbKey:P,tsKey:P,field:ue,relationTableTsKey:Ne,isJson:!0,selection:le.selection})}}if(u.length===0)throw new vo({message:`No fields selected for table "${i.tsName}" ("${o}")`});let b;if(m=Ae(l,m),c){let w=v`json_build_array(${v.join(u.map(({field:O,tsKey:R,isJson:C})=>C?v`${v.identifier(`${o}_${R}`)}.${v.identifier("data")}`:S(O,B.Aliased)?O.sql:O),v`, `)})`;S(c,ko)&&(w=v`coalesce(json_agg(${w}${f.length>0?v` order by ${v.join(f,v`, `)}`:void 0}), '[]'::json)`);let _=[{dbKey:"data",tsKey:"data",field:w.as("data"),isJson:!0,relationTableTsKey:i.tsName,selection:u}];p!==void 0||d!==void 0||f.length>0?(b=this.buildSelectQuery({table:mo(a,o),fields:{},fieldsFlat:[{path:[],field:v.raw("*")}],where:m,limit:p,offset:d,orderBy:f,setOperators:[]}),m=void 0,p=void 0,d=void 0,f=[]):b=mo(a,o),b=this.buildSelectQuery({table:S(b,mt)?b:new nt(b,{},o),fields:{},fieldsFlat:_.map(({field:O})=>({path:[],field:S(O,ye)?Lr(O,o):O})),joins:h,where:m,limit:p,offset:d,orderBy:f,setOperators:[]})}else b=this.buildSelectQuery({table:mo(a,o),fields:{},fieldsFlat:u.map(({field:w})=>({path:[],field:S(w,ye)?Lr(w,o):w})),joins:h,where:m,limit:p,offset:d,orderBy:f,setOperators:[]});return{tableTsKey:i.tsName,sql:b,selection:u}}};var pu=class{static[x]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}};var St=class{static[x]="PgSelectBuilder";fields;session;dialect;withList=[];distinct;constructor(e){this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,e.withList&&(this.withList=e.withList),this.distinct=e.distinct}authToken;setToken(e){return this.authToken=e,this}from(e){let r=!!this.fields,n=e,a;return this.fields?a=this.fields:S(n,nt)?a=Object.fromEntries(Object.keys(n._.selectedFields).map(i=>[i,n[i]])):S(n,Pi)?a=n[Oe].selectedFields:S(n,B)?a={}:a=nu(n),new du({table:n,fields:a,isPartialSelect:r,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct}).setToken(this.authToken)}},kg=class extends pu{static[x]="PgSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;constructor({table:e,fields:r,isPartialSelect:n,session:a,dialect:i,withList:s,distinct:o}){super(),this.config={withList:s,table:e,fields:{...r},distinct:o,setOperators:[]},this.isPartialSelect=n,this.session=a,this.dialect=i,this._={selectedFields:r},this.tableName=Kr(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}createJoin(e){return(r,n)=>{let a=this.tableName,i=Kr(r);if(typeof i=="string"&&this.config.joins?.some(s=>s.alias===i))throw new Error(`Alias "${i}" is already used in this query`);if(!this.isPartialSelect&&(Object.keys(this.joinsNotNullableMap).length===1&&typeof a=="string"&&(this.config.fields={[a]:this.config.fields}),typeof i=="string"&&!S(r,B))){let s=S(r,nt)?r._.selectedFields:S(r,Rt)?r[Oe].selectedFields:r[L.Symbol.Columns];this.config.fields[i]=s}if(typeof n=="function"&&(n=n(new Proxy(this.config.fields,new Ye({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:n,table:r,joinType:e,alias:i}),typeof i=="string")switch(e){case"left":{this.joinsNotNullableMap[i]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[i]=!0;break}case"inner":{this.joinsNotNullableMap[i]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[i]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");createSetOperator(e,r){return n=>{let a=typeof n=="function"?n(kF()):n;if(!go(this.getSelectedFields(),a.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:r,rightSelect:a}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new Ye({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new Ye({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if(typeof e[0]=="function"){let r=e[0](new Proxy(this.config.fields,new Ye({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(r)?r:[r]}else this.config.groupBy=e;return this}orderBy(...e){if(typeof e[0]=="function"){let r=e[0](new Proxy(this.config.fields,new Ye({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),n=Array.isArray(r)?r:[r];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=n:this.config.orderBy=n}else{let r=e;this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=r:this.config.orderBy=r}return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}for(e,r={}){return this.config.lockingClause={strength:e,config:r},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}as(e){return new Proxy(new nt(this.getSQL(),this.config.fields,e),new Ye({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new Ye({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}},du=class extends kg{static[x]="PgSelect";_prepare(e){let{session:r,config:n,dialect:a,joinsNotNullableMap:i,authToken:s}=this;if(!r)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");return Pe.startActiveSpan("drizzle.prepareQuery",()=>{let o=lr(n.fields),c=r.prepareQuery(a.sqlToQuery(this.getSQL()),o,e,!0);return c.joinsNotNullableMap=i,c.setToken(s)})}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>Pe.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};G8(du,[_t]);function Oi(t,e){return(r,n,...a)=>{let i=[n,...a].map(s=>({type:t,isAll:e,rightSelect:s}));for(let s of i)if(!go(r.getSelectedFields(),s.rightSelect.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return r.addSetOperators(i)}}var kF=()=>({union:PF,unionAll:OF,intersect:NF,intersectAll:jF,except:RF,exceptAll:DF}),PF=Oi("union",!1),OF=Oi("union",!0),NF=Oi("intersect",!1),jF=Oi("intersect",!0),RF=Oi("except",!1),DF=Oi("except",!0);var Ni=class{static[x]="PgQueryBuilder";dialect;dialectConfig;constructor(e){this.dialect=S(e,In)?e:void 0,this.dialectConfig=S(e,In)?void 0:e}$with=(e,r)=>{let n=this;return{as:i=>(typeof i=="function"&&(i=i(n)),new Proxy(new Ci(i.getSQL(),r??("getSelectedFields"in i?i.getSelectedFields()??{}:{}),e,!0),new Ye({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...e){let r=this;function n(s){return new St({fields:s??void 0,session:void 0,dialect:r.getDialect(),withList:e})}function a(s){return new St({fields:s??void 0,session:void 0,dialect:r.getDialect(),distinct:!0})}function i(s,o){return new St({fields:o??void 0,session:void 0,dialect:r.getDialect(),distinct:{on:s}})}return{select:n,selectDistinct:a,selectDistinctOn:i}}select(e){return new St({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new St({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(e,r){return new St({fields:r??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:e}})}getDialect(){return this.dialect||(this.dialect=new In(this.dialectConfig)),this.dialect}};var Po=class{constructor(e,r,n,a,i){this.table=e,this.session=r,this.dialect=n,this.withList=a,this.overridingSystemValue_=i}static[x]="PgInsertBuilder";authToken;setToken(e){return this.authToken=e,this}overridingSystemValue(){return this.overridingSystemValue_=!0,this}values(e){if(e=Array.isArray(e)?e:[e],e.length===0)throw new Error("values() must be called with at least one value");let r=e.map(n=>{let a={},i=this.table[L.Symbol.Columns];for(let s of Object.keys(n)){let o=n[s];a[s]=S(o,B)?o:new Vt(o,i[s])}return a});return new fu(this.table,r,this.session,this.dialect,this.withList,!1,this.overridingSystemValue_).setToken(this.authToken)}select(e){let r=typeof e=="function"?e(new Ni):e;if(!S(r,B)&&!go(this.table[tu],r._.selectedFields))throw new Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new fu(this.table,r,this.session,this.dialect,this.withList,!0)}},fu=class extends _t{constructor(e,r,n,a,i,s,o){super(),this.session=n,this.dialect=a,this.config={table:e,values:r,withList:i,select:s,overridingSystemValue_:o}}static[x]="PgInsert";config;returning(e=this.config.table[L.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=lr(e),this}onConflictDoNothing(e={}){if(e.target===void 0)this.config.onConflict=v`do nothing`;else{let r="";r=Array.isArray(e.target)?e.target.map(a=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(a))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target));let n=e.where?v` where ${e.where}`:void 0;this.config.onConflict=v`(${v.raw(r)})${n} do nothing`}return this}onConflictDoUpdate(e){if(e.where&&(e.targetWhere||e.setWhere))throw new Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');let r=e.where?v` where ${e.where}`:void 0,n=e.targetWhere?v` where ${e.targetWhere}`:void 0,a=e.setWhere?v` where ${e.setWhere}`:void 0,i=this.dialect.buildUpdateSet(this.config.table,ru(this.config.table,e.set)),s="";return s=Array.isArray(e.target)?e.target.map(o=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(o))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target)),this.config.onConflict=v`(${v.raw(s)})${n} do update set ${i}${r}${a}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return Pe.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>Pe.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new Ye({alias:Qt(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var mu=class extends _t{constructor(e,r,n){super(),this.session=r,this.dialect=n,this.config={view:e}}static[x]="PgRefreshMaterializedView";config;concurrently(){if(this.config.withNoData!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(this.config.concurrently!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return Pe.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>Pe.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};var Oo=class{constructor(e,r,n,a){this.table=e,this.session=r,this.dialect=n,this.withList=a}static[x]="PgUpdateBuilder";authToken;setToken(e){return this.authToken=e,this}set(e){return new Pg(this.table,ru(this.table,e),this.session,this.dialect,this.withList).setToken(this.authToken)}},Pg=class extends _t{constructor(e,r,n,a,i){super(),this.session=n,this.dialect=a,this.config={set:r,table:e,withList:i,joins:[]},this.tableName=Kr(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}static[x]="PgUpdate";config;tableName;joinsNotNullableMap;from(e){let r=e,n=Kr(r);return typeof n=="string"&&(this.joinsNotNullableMap[n]=!0),this.config.from=r,this}getTableLikeFields(e){return S(e,mt)?e[L.Symbol.Columns]:S(e,nt)?e._.selectedFields:e[Oe].selectedFields}createJoin(e){return(r,n)=>{let a=Kr(r);if(typeof a=="string"&&this.config.joins.some(i=>i.alias===a))throw new Error(`Alias "${a}" is already used in this query`);if(typeof n=="function"){let i=this.config.from&&!S(this.config.from,B)?this.getTableLikeFields(this.config.from):void 0;n=n(new Proxy(this.config.table[L.Symbol.Columns],new Ye({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),i&&new Proxy(i,new Ye({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}if(this.config.joins.push({on:n,table:r,joinType:e,alias:a}),typeof a=="string")switch(e){case"left":{this.joinsNotNullableMap[a]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([i])=>[i,!1])),this.joinsNotNullableMap[a]=!0;break}case"inner":{this.joinsNotNullableMap[a]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([i])=>[i,!1])),this.joinsNotNullableMap[a]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(e){return this.config.where=e,this}returning(e){if(!e&&(e=Object.assign({},this.config.table[L.Symbol.Columns]),this.config.from)){let r=Kr(this.config.from);if(typeof r=="string"&&this.config.from&&!S(this.config.from,B)){let n=this.getTableLikeFields(this.config.from);e[r]=n}for(let n of this.config.joins){let a=Kr(n.table);if(typeof a=="string"&&!S(n.table,B)){let i=this.getTableLikeFields(n.table);e[a]=i}}}return this.config.returningFields=e,this.config.returning=lr(e),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){let r=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0);return r.joinsNotNullableMap=this.joinsNotNullableMap,r}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>this._prepare().execute(e,this.authToken);getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new Ye({alias:Qt(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var hu=class t extends B{constructor(e){super(t.buildEmbeddedCount(e.source,e.filters).queryChunks),this.params=e,this.mapWith(Number),this.session=e.session,this.sql=t.buildCount(e.source,e.filters)}sql;token;static[x]="PgCountBuilder";[Symbol.toStringTag]="PgCountBuilder";session;static buildEmbeddedCount(e,r){return v`(select count(*) from ${e}${v.raw(" where ").if(r)}${r})`}static buildCount(e,r){return v`select count(*) as count from ${e}${v.raw(" where ").if(r)}${r};`}setToken(e){return this.token=e,this}then(e,r){return Promise.resolve(this.session.count(this.sql,this.token)).then(e,r)}catch(e){return this.then(void 0,e)}finally(e){return this.then(r=>(e?.(),r),r=>{throw e?.(),r})}};var gu=class{constructor(e,r,n,a,i,s,o){this.fullSchema=e,this.schema=r,this.tableNamesMap=n,this.table=a,this.tableConfig=i,this.dialect=s,this.session=o}static[x]="PgRelationalQueryBuilder";findMany(e){return new yu(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many")}findFirst(e){return new yu(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first")}},yu=class extends _t{constructor(e,r,n,a,i,s,o,c,l){super(),this.fullSchema=e,this.schema=r,this.tableNamesMap=n,this.table=a,this.tableConfig=i,this.dialect=s,this.session=o,this.config=c,this.mode=l}static[x]="PgRelationalQuery";_prepare(e){return Pe.startActiveSpan("drizzle.prepareQuery",()=>{let{query:r,builtQuery:n}=this._toSQL();return this.session.prepareQuery(n,void 0,e,!0,(a,i)=>{let s=a.map(o=>uu(this.schema,this.tableConfig,o,r.selection,i));return this.mode==="first"?s[0]:s})})}prepare(e){return this._prepare(e)}_getQuery(){return this.dialect.buildRelationalQueryWithoutPK({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){let e=this._getQuery(),r=this.dialect.sqlToQuery(e.sql);return{query:e,builtQuery:r}}toSQL(){return this._toSQL().builtQuery}authToken;setToken(e){return this.authToken=e,this}execute(){return Pe.startActiveSpan("drizzle.operation",()=>this._prepare().execute(void 0,this.authToken))}};var vu=class extends _t{constructor(e,r,n,a){super(),this.execute=e,this.sql=r,this.query=n,this.mapBatchResult=a}static[x]="PgRaw";getSQL(){return this.sql}getQuery(){return this.query}mapResult(e,r){return r?this.mapBatchResult(e):e}_prepare(){return this}isResponseInArrayMode(){return!1}};var ji=class{constructor(e,r,n){if(this.dialect=e,this.session=r,this._=n?{schema:n.schema,fullSchema:n.fullSchema,tableNamesMap:n.tableNamesMap,session:r}:{schema:void 0,fullSchema:{},tableNamesMap:{},session:r},this.query={},this._.schema)for(let[a,i]of Object.entries(this._.schema))this.query[a]=new gu(n.fullSchema,this._.schema,this._.tableNamesMap,n.fullSchema[a],i,e,r)}static[x]="PgDatabase";query;$with=(e,r)=>{let n=this;return{as:i=>(typeof i=="function"&&(i=i(new Ni(n.dialect))),new Proxy(new Ci(i.getSQL(),r??("getSelectedFields"in i?i.getSelectedFields()??{}:{}),e,!0),new Ye({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(e,r){return new hu({source:e,filters:r,session:this.session})}with(...e){let r=this;function n(l){return new St({fields:l??void 0,session:r.session,dialect:r.dialect,withList:e})}function a(l){return new St({fields:l??void 0,session:r.session,dialect:r.dialect,withList:e,distinct:!0})}function i(l,u){return new St({fields:u??void 0,session:r.session,dialect:r.dialect,withList:e,distinct:{on:l}})}function s(l){return new Oo(l,r.session,r.dialect,e)}function o(l){return new Po(l,r.session,r.dialect,e)}function c(l){return new yo(l,r.session,r.dialect,e)}return{select:n,selectDistinct:a,selectDistinctOn:i,update:s,insert:o,delete:c}}select(e){return new St({fields:e??void 0,session:this.session,dialect:this.dialect})}selectDistinct(e){return new St({fields:e??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn(e,r){return new St({fields:r??void 0,session:this.session,dialect:this.dialect,distinct:{on:e}})}update(e){return new Oo(e,this.session,this.dialect)}insert(e){return new Po(e,this.session,this.dialect)}delete(e){return new yo(e,this.session,this.dialect)}refreshMaterializedView(e){return new mu(e,this.session,this.dialect)}authToken;execute(e){let r=typeof e=="string"?v.raw(e):e.getSQL(),n=this.dialect.sqlToQuery(r),a=this.session.prepareQuery(n,void 0,void 0,!1);return new vu(()=>a.execute(void 0,this.authToken),r,n,i=>a.mapResult(i,!0))}transaction(e,r){return this.session.transaction(e,r)}};var Og=class{constructor(e,r){this.unique=e,this.name=r}static[x]="PgIndexBuilderOn";on(...e){return new No(e.map(r=>{if(S(r,B))return r;r=r;let n=new Ii(r.name,!!r.keyAsName,r.columnType,r.indexConfig);return r.indexConfig=JSON.parse(JSON.stringify(r.defaultConfig)),n}),this.unique,!1,this.name)}onOnly(...e){return new No(e.map(r=>{if(S(r,B))return r;r=r;let n=new Ii(r.name,!!r.keyAsName,r.columnType,r.indexConfig);return r.indexConfig=r.defaultConfig,n}),this.unique,!0,this.name)}using(e,...r){return new No(r.map(n=>{if(S(n,B))return n;n=n;let a=new Ii(n.name,!!n.keyAsName,n.columnType,n.indexConfig);return n.indexConfig=JSON.parse(JSON.stringify(n.defaultConfig)),a}),this.unique,!0,this.name,e)}},No=class{static[x]="PgIndexBuilder";config;constructor(e,r,n,a,i="btree"){this.config={name:a,columns:e,unique:r,only:n,method:i}}concurrently(){return this.config.concurrently=!0,this}with(e){return this.config.with=e,this}where(e){return this.config.where=e,this}build(e){return new Ng(this.config,e)}},Ng=class{static[x]="PgIndex";config;constructor(e,r){this.config={...e,table:r}}};function HT(t){return new Og(!1,t)}var xu=class{constructor(e){this.query=e}authToken;getQuery(){return this.query}mapResult(e,r){return e}setToken(e){return this.authToken=e,this}static[x]="PgPreparedQuery";joinsNotNullableMap},bu=class{constructor(e){this.dialect=e}static[x]="PgSession";execute(e,r){return Pe.startActiveSpan("drizzle.operation",()=>Pe.startActiveSpan("drizzle.prepareQuery",()=>this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1)).setToken(r).execute(void 0,r))}all(e){return this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1).all()}async count(e,r){let n=await this.execute(e,r);return Number(n[0].count)}},wu=class extends ji{constructor(e,r,n,a=0){super(e,r,n),this.schema=n,this.nestedIndex=a}static[x]="PgTransaction";rollback(){throw new iu}getTransactionConfigSQL(e){let r=[];return e.isolationLevel&&r.push(`isolation level ${e.isolationLevel}`),e.accessMode&&r.push(e.accessMode),typeof e.deferrable=="boolean"&&r.push(e.deferrable?"deferrable":"not deferrable"),v.raw(r.join(" "))}setTransaction(e){return this.session.execute(v`set transaction ${this.getTransactionConfigSQL(e)}`)}};var{Pool:QT,types:Br}=_n,jg=class extends xu{constructor(e,r,n,a,i,s,o,c){super({sql:r,params:n}),this.client=e,this.params=n,this.logger=a,this.fields=i,this._isResponseInArrayMode=o,this.customResultMapper=c,this.rawQueryConfig={name:s,text:r,types:{getTypeParser:(l,u)=>l===Br.builtins.TIMESTAMPTZ?p=>p:l===Br.builtins.TIMESTAMP?p=>p:l===Br.builtins.DATE?p=>p:l===Br.builtins.INTERVAL?p=>p:Br.getTypeParser(l,u)}},this.queryConfig={name:s,text:r,rowMode:"array",types:{getTypeParser:(l,u)=>l===Br.builtins.TIMESTAMPTZ?p=>p:l===Br.builtins.TIMESTAMP?p=>p:l===Br.builtins.DATE?p=>p:l===Br.builtins.INTERVAL?p=>p:Br.getTypeParser(l,u)}}}static[x]="NodePgPreparedQuery";rawQueryConfig;queryConfig;async execute(e={}){return Pe.startActiveSpan("drizzle.execute",async()=>{let r=lh(this.params,e);this.logger.logQuery(this.rawQueryConfig.text,r);let{fields:n,rawQueryConfig:a,client:i,queryConfig:s,joinsNotNullableMap:o,customResultMapper:c}=this;if(!n&&!c)return Pe.startActiveSpan("drizzle.driver.execute",async u=>(u?.setAttributes({"drizzle.query.name":a.name,"drizzle.query.text":a.text,"drizzle.query.params":JSON.stringify(r)}),i.query(a,r)));let l=await Pe.startActiveSpan("drizzle.driver.execute",u=>(u?.setAttributes({"drizzle.query.name":s.name,"drizzle.query.text":s.text,"drizzle.query.params":JSON.stringify(r)}),i.query(s,r)));return Pe.startActiveSpan("drizzle.mapResponse",()=>c?c(l.rows):l.rows.map(u=>V8(n,u,o)))})}all(e={}){return Pe.startActiveSpan("drizzle.execute",()=>{let r=lh(this.params,e);return this.logger.logQuery(this.rawQueryConfig.text,r),Pe.startActiveSpan("drizzle.driver.execute",n=>(n?.setAttributes({"drizzle.query.name":this.rawQueryConfig.name,"drizzle.query.text":this.rawQueryConfig.text,"drizzle.query.params":JSON.stringify(r)}),this.client.query(this.rawQueryConfig,r).then(a=>a.rows)))})}isResponseInArrayMode(){return this._isResponseInArrayMode}},_u=class t extends bu{constructor(e,r,n,a={}){super(r),this.client=e,this.schema=n,this.options=a,this.logger=a.logger??new Zl}static[x]="NodePgSession";logger;prepareQuery(e,r,n,a,i){return new jg(this.client,e.sql,e.params,this.logger,r,n,a,i)}async transaction(e,r){let n=this.client instanceof QT?new t(await this.client.connect(),this.dialect,this.schema,this.options):this,a=new Rg(this.dialect,n,this.schema);await a.execute(v`begin${r?v` ${a.getTransactionConfigSQL(r)}`:void 0}`);try{let i=await e(a);return await a.execute(v`commit`),i}catch(i){throw await a.execute(v`rollback`),i}finally{this.client instanceof QT&&n.client.release()}}async count(e){let r=await this.execute(e);return Number(r.rows[0].count)}},Rg=class t extends wu{static[x]="NodePgTransaction";async transaction(e){let r=`sp${this.nestedIndex+1}`,n=new t(this.dialect,this.session,this.schema,this.nestedIndex+1);await n.execute(v.raw(`savepoint ${r}`));try{let a=await e(n);return await n.execute(v.raw(`release savepoint ${r}`)),a}catch(a){throw await n.execute(v.raw(`rollback to savepoint ${r}`)),a}}};var Dg=class{constructor(e,r,n={}){this.client=e,this.dialect=r,this.options=n}static[x]="NodePgDriver";createSession(e){return new _u(this.client,this.dialect,e,{logger:this.options.logger})}},Lg=class extends ji{static[x]="NodePgDatabase"};function jo(t,e={}){let r=new In({casing:e.casing}),n;e.logger===!0?n=new Kl:e.logger!==!1&&(n=e.logger);let a;if(e.schema){let c=UT(e.schema,$T);a={fullSchema:e.schema,schema:c.tables,tableNamesMap:c.tableNamesMap}}let s=new Dg(t,r,{logger:n}).createSession(a),o=new Lg(r,s,a);return o.$client=t,o}function Eu(...t){if(typeof t[0]=="string"){let e=new _n.Pool({connectionString:t[0]});return jo(e,t[1])}if(K8(t[0])){let{connection:e,client:r,...n}=t[0];if(r)return jo(r,n);let a=typeof e=="string"?new _n.Pool({connectionString:e}):new _n.Pool(e);return jo(a,n)}return jo(t[0],t[1])}(t=>{function e(r){return jo({},r)}t.mock=e})(Eu||(Eu={}));var Bg={};uy(Bg,{accrualMethodEnum:()=>t6,accrualMethodOptions:()=>P$,appUsers:()=>ie,appUsersRelations:()=>GF,attendance:()=>Se,attendanceRelations:()=>KF,attendanceStatusEnum:()=>ZT,attendanceStatusOptions:()=>S$,carryForwardTypeEnum:()=>r6,carryForwardTypeOptions:()=>O$,compOffGrants:()=>At,compOffSourceEnum:()=>c6,documentTypeEnum:()=>l6,documentTypeOptions:()=>_$,employeeDocuments:()=>wr,employeeLeaveBalances:()=>bt,employees:()=>Y,employeesRelations:()=>WF,employmentPeriods:()=>zr,employmentStatusEnum:()=>YT,employmentStatusOptions:()=>T$,halfDaySessionEnum:()=>o6,holidays:()=>Xe,holidaysRelations:()=>YF,industryEnum:()=>qg,industryOptions:()=>E$,insertAppUserSchema:()=>a$,insertAttendanceSchema:()=>o$,insertCompOffGrantSchema:()=>v$,insertEmployeeDocumentSchema:()=>x$,insertEmployeeLeaveBalanceSchema:()=>h$,insertEmployeeSchema:()=>i$,insertEmploymentPeriodSchema:()=>s$,insertHolidaySchema:()=>l$,insertLeavePolicySchema:()=>m$,insertLeaveRequestSchema:()=>u$,insertLeaveTransactionSchema:()=>g$,insertNotificationSchema:()=>d$,insertOnboardingTaskSchema:()=>p$,insertOrganizationSchema:()=>n$,insertPasswordResetRequestSchema:()=>f$,insertPayslipSchema:()=>c$,insertTaxDeclarationItemSchema:()=>w$,insertTaxDeclarationSchema:()=>b$,insertTimeEntrySchema:()=>y$,leavePolicies:()=>Tt,leavePolicyCodeEnum:()=>e6,leavePolicyCodeOptions:()=>k$,leaveRequests:()=>Je,leaveRequestsRelations:()=>JF,leaveStatusEnum:()=>JT,leaveStatusOptions:()=>I$,leaveTransactionTypeEnum:()=>n6,leaveTransactions:()=>Dt,leaveTypeEnum:()=>XT,leaveTypeOptions:()=>A$,notificationTypeEnum:()=>a6,notifications:()=>ht,notificationsRelations:()=>e$,onboardingTaskStatusEnum:()=>i6,onboardingTaskStatusOptions:()=>C$,onboardingTasks:()=>Ve,onboardingTasksRelations:()=>XF,organizations:()=>$,organizationsRelations:()=>VF,passwordResetRequests:()=>xt,payslips:()=>st,payslipsRelations:()=>ZF,section80CSubTypes:()=>R$,section80DSubTypes:()=>D$,sessions:()=>HF,taxDeclarationItems:()=>gt,taxDeclarationItemsRelations:()=>r$,taxDeclarationStatusEnum:()=>u6,taxDeclarationStatusOptions:()=>j$,taxDeclarations:()=>ce,taxDeclarationsRelations:()=>t$,taxDeductionCategoryEnum:()=>d6,taxDeductionCategoryOptions:()=>N$,taxRegimeEnum:()=>p6,timeEntries:()=>ze,timeEntryTypeEnum:()=>s6,userRoleEnum:()=>KT,users:()=>QF});var Qe={INT8_MIN:-128,INT8_MAX:127,INT8_UNSIGNED_MAX:255,INT16_MIN:-32768,INT16_MAX:32767,INT16_UNSIGNED_MAX:65535,INT24_MIN:-8388608,INT24_MAX:8388607,INT24_UNSIGNED_MAX:16777215,INT32_MIN:-2147483648,INT32_MAX:2147483647,INT32_UNSIGNED_MAX:4294967295,INT48_MIN:-0x800000000000,INT48_MAX:0x7fffffffffff,INT48_UNSIGNED_MAX:0xffffffffffff,INT64_MIN:-9223372036854775808n,INT64_MAX:9223372036854775807n,INT64_UNSIGNED_MAX:18446744073709551615n};function et(t,e){return e.includes(t.columnType)}function LF(t){return"enumValues"in t&&Array.isArray(t.enumValues)&&t.enumValues.length>0}var qF=J.union([J.string(),J.number(),J.boolean(),J.null()]),BF=J.union([qF,J.record(J.any()),J.array(J.any())]),zF=J.custom(t=>t instanceof Buffer);function VT(t,e){let r=e?.zodInstance??J,n=e?.coerce??{},a;return LF(t)&&(a=t.enumValues.length?r.enum(t.enumValues):r.string()),a||(et(t,["PgGeometry","PgPointTuple"])?a=r.tuple([r.number(),r.number()]):et(t,["PgGeometryObject","PgPointObject"])?a=r.object({x:r.number(),y:r.number()}):et(t,["PgHalfVector","PgVector"])?(a=r.array(r.number()),a=t.dimensions?a.length(t.dimensions):a):et(t,["PgLine"])?a=r.tuple([r.number(),r.number(),r.number()]):et(t,["PgLineABC"])?a=r.object({a:r.number(),b:r.number(),c:r.number()}):et(t,["PgArray"])?(a=r.array(VT(t.baseColumn,r)),a=t.size?a.length(t.size):a):t.dataType==="array"?a=r.array(r.any()):t.dataType==="number"?a=MF(t,r,n):t.dataType==="bigint"?a=UF(t,r,n):t.dataType==="boolean"?a=n===!0||n.boolean?r.coerce.boolean():r.boolean():t.dataType==="date"?a=n===!0||n.date?r.coerce.date():r.date():t.dataType==="string"?a=FF(t,r,n):t.dataType==="json"?a=BF:t.dataType==="custom"?a=r.any():t.dataType==="buffer"&&(a=zF)),a||(a=r.any()),a}function MF(t,e,r){let n=t.getSQLType().includes("unsigned"),a,i,s=!1;et(t,["MySqlTinyInt","SingleStoreTinyInt"])?(a=n?0:Qe.INT8_MIN,i=n?Qe.INT8_UNSIGNED_MAX:Qe.INT8_MAX,s=!0):et(t,["PgSmallInt","PgSmallSerial","MySqlSmallInt","SingleStoreSmallInt"])?(a=n?0:Qe.INT16_MIN,i=n?Qe.INT16_UNSIGNED_MAX:Qe.INT16_MAX,s=!0):et(t,["PgReal","MySqlFloat","MySqlMediumInt","SingleStoreMediumInt","SingleStoreFloat"])?(a=n?0:Qe.INT24_MIN,i=n?Qe.INT24_UNSIGNED_MAX:Qe.INT24_MAX,s=et(t,["MySqlMediumInt","SingleStoreMediumInt"])):et(t,["PgInteger","PgSerial","MySqlInt","SingleStoreInt"])?(a=n?0:Qe.INT32_MIN,i=n?Qe.INT32_UNSIGNED_MAX:Qe.INT32_MAX,s=!0):et(t,["PgDoublePrecision","MySqlReal","MySqlDouble","SingleStoreReal","SingleStoreDouble","SQLiteReal"])?(a=n?0:Qe.INT48_MIN,i=n?Qe.INT48_UNSIGNED_MAX:Qe.INT48_MAX):et(t,["PgBigInt53","PgBigSerial53","MySqlBigInt53","MySqlSerial","SingleStoreBigInt53","SingleStoreSerial","SQLiteInteger"])?(n=n||et(t,["MySqlSerial","SingleStoreSerial"]),a=n?0:Number.MIN_SAFE_INTEGER,i=Number.MAX_SAFE_INTEGER,s=!0):et(t,["MySqlYear","SingleStoreYear"])?(a=1901,i=2155,s=!0):(a=Number.MIN_SAFE_INTEGER,i=Number.MAX_SAFE_INTEGER);let o=r===!0||r?.number?e.coerce.number():e.number();return o=o.min(a).max(i),s?o.int():o}function UF(t,e,r){let n=t.getSQLType().includes("unsigned"),a=n?0n:Qe.INT64_MIN,i=n?Qe.INT64_UNSIGNED_MAX:Qe.INT64_MAX;return(r===!0||r?.bigint?e.coerce.bigint():e.bigint()).min(a).max(i)}function FF(t,e,r){if(et(t,["PgUUID"]))return e.string().uuid();let n,a,i=!1;et(t,["PgVarchar","SQLiteText"])?n=t.length:et(t,["MySqlVarChar","SingleStoreVarChar"])?n=t.length??Qe.INT16_UNSIGNED_MAX:et(t,["MySqlText","SingleStoreText"])&&(t.textType==="longtext"?n=Qe.INT32_UNSIGNED_MAX:t.textType==="mediumtext"?n=Qe.INT24_UNSIGNED_MAX:t.textType==="text"?n=Qe.INT16_UNSIGNED_MAX:n=Qe.INT8_UNSIGNED_MAX),et(t,["PgChar","MySqlChar","SingleStoreChar"])&&(n=t.length,i=!0),et(t,["PgBinaryVector"])&&(a=/^[01]+$/,n=t.dimensions);let s=r===!0||r?.string?e.coerce.string():e.string();return s=a?s.regex(a):s,n&&i?s.length(n):n?s.max(n):s}function GT(t){return oh(t)?nu(t):W8(t)}function WT(t,e,r,n){let a={};for(let[i,s]of Object.entries(t)){if(!S(s,ye)&&!S(s,B)&&!S(s,B.Aliased)&&typeof s=="object"){let p=oh(s)||H8(s)?GT(s):s;a[i]=WT(p,e[i]??{},r,n);continue}let o=e[i];if(o!==void 0&&typeof o!="function"){a[i]=o;continue}let c=S(s,ye)?s:void 0,l=c?VT(c,n):J.any(),u=typeof o=="function"?o(l):l;r.never(c)||(a[i]=u,c&&(r.nullable(c)&&(a[i]=a[i].nullable()),r.optional(c)&&(a[i]=a[i].optional())))}return J.object(a)}var $F={never:t=>t?.generated?.type==="always"||t?.generatedIdentity?.type==="always",optional:t=>!t.notNull||t.notNull&&t.hasDefault,nullable:t=>!t.notNull};var it=(t,e)=>{let r=GT(t);return WT(r,e??{},$F)};var HF=He("sessions",{sid:N("sid").primaryKey(),sess:su("sess").notNull(),expire:oe("expire").notNull()},t=>[HT("IDX_session_expire").on(t.expire)]),QF=He("users",{id:N("id").primaryKey().default(v`gen_random_uuid()`),email:N("email").unique(),firstName:N("first_name"),lastName:N("last_name"),profileImageUrl:N("profile_image_url"),createdAt:oe("created_at").defaultNow(),updatedAt:oe("updated_at").defaultNow()});var KT=rt("user_role",["super_admin","org_admin","employee"]),qg=rt("industry",["technology","healthcare","finance","education","manufacturing","retail","hospitality","construction","government","other"]),ZT=rt("attendance_status",["present","absent","half_day","leave","holiday"]),YT=rt("employment_status",["active","exited","on_notice"]),JT=rt("leave_status",["pending","approved","rejected"]),XT=rt("leave_type",["annual","sick","personal","maternity","paternity","unpaid","other"]),e6=rt("leave_policy_code",["CL","PL","SL","COMP_OFF"]),t6=rt("accrual_method",["monthly","yearly","none"]),r6=rt("carry_forward_type",["none","limited","unlimited"]),n6=rt("leave_transaction_type",["accrual","request","adjustment","carry_forward","lapse"]),a6=rt("notification_type",["leave_request","leave_approved","leave_rejected","onboarding_task","task_completed","general","password_reset_request"]),i6=rt("onboarding_task_status",["pending","in_progress","completed"]),s6=rt("time_entry_type",["check_in","check_out"]),o6=rt("half_day_session",["AM","PM"]),c6=rt("comp_off_source",["overtime","holiday_work","manual"]),l6=rt("document_type",["offer_letter","appointment_letter","aadhar","pan","photo","other"]),u6=rt("tax_declaration_status",["draft","submitted","verified"]),p6=rt("tax_regime",["old","new"]),d6=rt("tax_deduction_category",["HRA","LTA","HOME_LOAN_INTEREST","80C","80CCD_EMPLOYEE","80CCD_EMPLOYER","80D","80DD","80DDB","80E","80EE","80G","80GG","80TTA","80U","OTHER","AGNIVEER","HOME_LOAN_INTEREST_LET_OUT","FAMILY_PENSION","TRANSPORT_DISABLED","GRATUITY","LEAVE_ENCASHMENT"]),$=He("organizations",{id:N("id").primaryKey().default(v`gen_random_uuid()`),name:F("name").notNull(),code:F("code"),legalName:F("legal_name"),industry:qg("industry").notNull().default("other"),address:F("address"),phone:F("phone"),email:F("email"),website:F("website"),logoUrl:F("logo_url"),gstNumber:F("gst_number"),panNumber:F("pan_number"),tanNumber:F("tan_number"),cinNumber:F("cin_number"),udyamNumber:F("udyam_number"),fssaiNumber:F("fssai_number"),isActive:Xt("is_active").notNull().default(!0),createdAt:oe("created_at").defaultNow()}),ie=He("app_users",{id:N("id").primaryKey().default(v`gen_random_uuid()`),email:N("email").notNull().unique(),password:N("password").notNull(),firstName:N("first_name"),lastName:N("last_name"),organizationId:N("organization_id").references(()=>$.id),role:KT("role").notNull().default("employee"),employeeId:N("employee_id"),isActive:Xt("is_active").notNull().default(!0),inviteToken:N("invite_token"),isPending:Xt("is_pending").notNull().default(!1),passwordResetToken:N("password_reset_token"),passwordResetExpires:oe("password_reset_expires"),createdAt:oe("created_at").defaultNow()}),Y=He("employees",{id:N("id").primaryKey().default(v`gen_random_uuid()`),organizationId:N("organization_id").notNull().references(()=>$.id),employeeCode:F("employee_code").notNull(),firstName:F("first_name").notNull(),lastName:F("last_name").notNull(),email:F("email").notNull(),phone:F("phone"),department:F("department"),designation:F("designation"),dateOfJoining:Et("date_of_joining").notNull(),dateOfExit:Et("date_of_exit"),status:YT("status").notNull().default("active"),exitReason:F("exit_reason"),salary:ur("salary"),address:F("address"),emergencyContact:F("emergency_contact"),profileImageUrl:F("profile_image_url"),createdAt:oe("created_at").defaultNow()}),wr=He("employee_documents",{id:N("id").primaryKey().default(v`gen_random_uuid()`),employeeId:N("employee_id").notNull().references(()=>Y.id),organizationId:N("organization_id").notNull().references(()=>$.id),documentType:l6("document_type").notNull(),documentName:F("document_name"),fileName:F("file_name").notNull(),filePath:F("file_path").notNull(),mimeType:F("mime_type"),fileSize:ur("file_size"),uploadedBy:N("uploaded_by").references(()=>ie.id),uploadedAt:oe("uploaded_at").defaultNow()}),zr=He("employment_periods",{id:N("id").primaryKey().default(v`gen_random_uuid()`),employeeId:N("employee_id").notNull().references(()=>Y.id),organizationId:N("organization_id").notNull().references(()=>$.id),startDate:Et("start_date").notNull(),endDate:Et("end_date"),exitReason:F("exit_reason"),rejoinNotes:F("rejoin_notes"),createdAt:oe("created_at").defaultNow()}),Se=He("attendance",{id:N("id").primaryKey().default(v`gen_random_uuid()`),employeeId:N("employee_id").notNull().references(()=>Y.id),organizationId:N("organization_id").notNull().references(()=>$.id),date:Et("date").notNull(),status:ZT("status").notNull(),checkIn:F("check_in"),checkOut:F("check_out"),notes:F("notes"),createdAt:oe("created_at").defaultNow()}),st=He("payslips",{id:N("id").primaryKey().default(v`gen_random_uuid()`),employeeId:N("employee_id").notNull().references(()=>Y.id),organizationId:N("organization_id").notNull().references(()=>$.id),month:ur("month").notNull(),year:ur("year").notNull(),fileName:F("file_name").notNull(),fileUrl:F("file_url").notNull(),fileSize:ur("file_size"),uploadedAt:oe("uploaded_at").defaultNow()}),Xe=He("holidays",{id:N("id").primaryKey().default(v`gen_random_uuid()`),organizationId:N("organization_id").references(()=>$.id),name:F("name").notNull(),date:Et("date").notNull(),industry:qg("industry"),isNational:Xt("is_national").notNull().default(!1),isCustom:Xt("is_custom").notNull().default(!1),createdAt:oe("created_at").defaultNow()}),Je=He("leave_requests",{id:N("id").primaryKey().default(v`gen_random_uuid()`),employeeId:N("employee_id").notNull().references(()=>Y.id),organizationId:N("organization_id").notNull().references(()=>$.id),policyId:N("policy_id").references(()=>Tt.id),leaveType:XT("leave_type").notNull(),startDate:Et("start_date").notNull(),endDate:Et("end_date").notNull(),totalDays:vt("total_days",{precision:4,scale:1}).notNull().default("1"),isHalfDay:Xt("is_half_day").notNull().default(!1),halfDaySession:o6("half_day_session"),reason:F("reason"),status:JT("status").notNull().default("pending"),reviewedBy:N("reviewed_by").references(()=>ie.id),reviewedAt:oe("reviewed_at"),reviewNotes:F("review_notes"),createdAt:oe("created_at").defaultNow()}),Ve=He("onboarding_tasks",{id:N("id").primaryKey().default(v`gen_random_uuid()`),employeeId:N("employee_id").notNull().references(()=>Y.id),organizationId:N("organization_id").notNull().references(()=>$.id),title:F("title").notNull(),description:F("description"),dueDate:Et("due_date"),status:i6("status").notNull().default("pending"),assignedTo:N("assigned_to").references(()=>ie.id),completedAt:oe("completed_at"),createdAt:oe("created_at").defaultNow()}),xt=He("password_reset_requests",{id:N("id").primaryKey().default(v`gen_random_uuid()`),email:N("email").notNull(),organizationId:N("organization_id").references(()=>$.id),status:N("status",{length:20}).notNull().default("pending"),completedBy:N("completed_by").references(()=>ie.id),completedAt:oe("completed_at"),createdAt:oe("created_at").defaultNow()}),Tt=He("leave_policies",{id:N("id").primaryKey().default(v`gen_random_uuid()`),organizationId:N("organization_id").notNull().references(()=>$.id),code:e6("code").notNull(),displayName:F("display_name").notNull(),annualQuota:ur("annual_quota").notNull().default(0),accrualMethod:t6("accrual_method").notNull().default("yearly"),monthlyAccrualRate:ur("monthly_accrual_rate").default(0),carryForwardType:r6("carry_forward_type").notNull().default("none"),carryForwardLimit:ur("carry_forward_limit").default(0),allowNegativeBalance:Xt("allow_negative_balance").notNull().default(!1),isActive:Xt("is_active").notNull().default(!0),effectiveFrom:Et("effective_from"),effectiveTo:Et("effective_to"),createdAt:oe("created_at").defaultNow()}),bt=He("employee_leave_balances",{id:N("id").primaryKey().default(v`gen_random_uuid()`),employeeId:N("employee_id").notNull().references(()=>Y.id),policyId:N("policy_id").notNull().references(()=>Tt.id),organizationId:N("organization_id").notNull().references(()=>$.id),year:ur("year").notNull(),openingBalance:vt("opening_balance",{precision:6,scale:1}).notNull().default("0"),accrued:vt("accrued",{precision:6,scale:1}).notNull().default("0"),used:vt("used",{precision:6,scale:1}).notNull().default("0"),adjustment:vt("adjustment",{precision:6,scale:1}).notNull().default("0"),currentBalance:vt("current_balance",{precision:6,scale:1}).notNull().default("0"),lastAccruedAt:oe("last_accrued_at"),createdAt:oe("created_at").defaultNow()}),Dt=He("leave_transactions",{id:N("id").primaryKey().default(v`gen_random_uuid()`),employeeId:N("employee_id").notNull().references(()=>Y.id),balanceId:N("balance_id").notNull().references(()=>bt.id),policyId:N("policy_id").notNull().references(()=>Tt.id),organizationId:N("organization_id").notNull().references(()=>$.id),transactionType:n6("transaction_type").notNull(),amount:vt("amount",{precision:6,scale:1}).notNull(),balanceAfter:vt("balance_after",{precision:6,scale:1}).notNull(),referenceId:N("reference_id"),notes:F("notes"),createdBy:N("created_by").references(()=>ie.id),createdAt:oe("created_at").defaultNow()}),ht=He("notifications",{id:N("id").primaryKey().default(v`gen_random_uuid()`),userId:N("user_id").notNull().references(()=>ie.id),organizationId:N("organization_id").references(()=>$.id),type:a6("type").notNull(),title:F("title").notNull(),message:F("message").notNull(),relatedId:N("related_id"),isRead:Xt("is_read").notNull().default(!1),createdAt:oe("created_at").defaultNow()}),ze=He("time_entries",{id:N("id").primaryKey().default(v`gen_random_uuid()`),employeeId:N("employee_id").notNull().references(()=>Y.id),organizationId:N("organization_id").notNull().references(()=>$.id),attendanceId:N("attendance_id").references(()=>Se.id),date:Et("date").notNull(),entryType:s6("entry_type").notNull(),entryTime:oe("entry_time").notNull(),notes:F("notes"),createdAt:oe("created_at").defaultNow()}),At=He("comp_off_grants",{id:N("id").primaryKey().default(v`gen_random_uuid()`),employeeId:N("employee_id").notNull().references(()=>Y.id),organizationId:N("organization_id").notNull().references(()=>$.id),workDate:Et("work_date").notNull(),hoursWorked:vt("hours_worked",{precision:4,scale:2}).notNull(),daysGranted:vt("days_granted",{precision:4,scale:1}).notNull(),source:c6("source").notNull(),reason:F("reason"),isApplied:Xt("is_applied").notNull().default(!1),appliedAt:oe("applied_at"),grantedBy:N("granted_by").references(()=>ie.id),createdAt:oe("created_at").defaultNow()}),ce=He("tax_declarations",{id:N("id").primaryKey().default(v`gen_random_uuid()`),employeeId:N("employee_id").notNull().references(()=>Y.id),organizationId:N("organization_id").notNull().references(()=>$.id),financialYear:N("financial_year",{length:9}).notNull(),taxRegime:p6("tax_regime").notNull().default("old"),status:u6("status").notNull().default("draft"),totalDeclared:vt("total_declared",{precision:12,scale:2}).notNull().default("0"),totalApproved:vt("total_approved",{precision:12,scale:2}),submittedAt:oe("submitted_at"),verifiedAt:oe("verified_at"),verifiedBy:N("verified_by").references(()=>ie.id),remarks:F("remarks"),createdAt:oe("created_at").defaultNow()}),gt=He("tax_declaration_items",{id:N("id").primaryKey().default(v`gen_random_uuid()`),declarationId:N("declaration_id").notNull().references(()=>ce.id,{onDelete:"cascade"}),category:d6("category").notNull(),subType:F("sub_type"),description:F("description"),amountDeclared:vt("amount_declared",{precision:12,scale:2}).notNull(),amountApproved:vt("amount_approved",{precision:12,scale:2}),providerName:F("provider_name"),policyNumber:F("policy_number"),createdAt:oe("created_at").defaultNow()}),VF=pr($,({many:t})=>({employees:t(Y),appUsers:t(ie),attendance:t(Se),payslips:t(st),holidays:t(Xe)})),GF=pr(ie,({one:t})=>({organization:t($,{fields:[ie.organizationId],references:[$.id]})})),WF=pr(Y,({one:t,many:e})=>({organization:t($,{fields:[Y.organizationId],references:[$.id]}),attendance:e(Se),payslips:e(st)})),KF=pr(Se,({one:t})=>({employee:t(Y,{fields:[Se.employeeId],references:[Y.id]}),organization:t($,{fields:[Se.organizationId],references:[$.id]})})),ZF=pr(st,({one:t})=>({employee:t(Y,{fields:[st.employeeId],references:[Y.id]}),organization:t($,{fields:[st.organizationId],references:[$.id]})})),YF=pr(Xe,({one:t})=>({organization:t($,{fields:[Xe.organizationId],references:[$.id]})})),JF=pr(Je,({one:t})=>({employee:t(Y,{fields:[Je.employeeId],references:[Y.id]}),organization:t($,{fields:[Je.organizationId],references:[$.id]}),reviewer:t(ie,{fields:[Je.reviewedBy],references:[ie.id]})})),XF=pr(Ve,({one:t})=>({employee:t(Y,{fields:[Ve.employeeId],references:[Y.id]}),organization:t($,{fields:[Ve.organizationId],references:[$.id]}),assignee:t(ie,{fields:[Ve.assignedTo],references:[ie.id]})})),e$=pr(ht,({one:t})=>({user:t(ie,{fields:[ht.userId],references:[ie.id]}),organization:t($,{fields:[ht.organizationId],references:[$.id]})})),t$=pr(ce,({one:t,many:e})=>({employee:t(Y,{fields:[ce.employeeId],references:[Y.id]}),organization:t($,{fields:[ce.organizationId],references:[$.id]}),verifier:t(ie,{fields:[ce.verifiedBy],references:[ie.id]}),items:e(gt)})),r$=pr(gt,({one:t})=>({declaration:t(ce,{fields:[gt.declarationId],references:[ce.id]})})),n$=it($).omit({id:!0,createdAt:!0}),a$=it(ie).omit({id:!0,createdAt:!0}),i$=it(Y).omit({id:!0,createdAt:!0}),s$=it(zr).omit({id:!0,createdAt:!0}),o$=it(Se).omit({id:!0,createdAt:!0}),c$=it(st).omit({id:!0,uploadedAt:!0}),l$=it(Xe).omit({id:!0,createdAt:!0}),u$=it(Je).omit({id:!0,createdAt:!0,reviewedAt:!0}),p$=it(Ve).omit({id:!0,createdAt:!0,completedAt:!0}),d$=it(ht).omit({id:!0,createdAt:!0}),f$=it(xt).omit({id:!0,createdAt:!0,completedAt:!0}),m$=it(Tt).omit({id:!0,createdAt:!0}),h$=it(bt).omit({id:!0,createdAt:!0}),g$=it(Dt).omit({id:!0,createdAt:!0}),y$=it(ze).omit({id:!0,createdAt:!0}),v$=it(At).omit({id:!0,createdAt:!0}),x$=it(wr).omit({id:!0,uploadedAt:!0}),b$=it(ce).omit({id:!0,createdAt:!0,submittedAt:!0,verifiedAt:!0}),w$=it(gt).omit({id:!0,createdAt:!0}),_$=[{value:"offer_letter",label:"Offer Letter"},{value:"appointment_letter",label:"Appointment Letter"},{value:"aadhar",label:"Aadhar Card"},{value:"pan",label:"PAN Card"},{value:"photo",label:"Passport Photo"},{value:"other",label:"Other Document"}],E$=[{value:"technology",label:"Technology"},{value:"healthcare",label:"Healthcare"},{value:"finance",label:"Finance"},{value:"education",label:"Education"},{value:"manufacturing",label:"Manufacturing"},{value:"retail",label:"Retail"},{value:"hospitality",label:"Hospitality"},{value:"construction",label:"Construction"},{value:"government",label:"Government"},{value:"other",label:"Other"}],S$=[{value:"present",label:"Present",color:"green"},{value:"absent",label:"Absent",color:"red"},{value:"half_day",label:"Half Day",color:"yellow"},{value:"leave",label:"Leave",color:"blue"},{value:"holiday",label:"Holiday",color:"purple"}],T$=[{value:"active",label:"Active"},{value:"exited",label:"Exited"},{value:"on_notice",label:"On Notice"}],A$=[{value:"annual",label:"Annual Leave"},{value:"sick",label:"Sick Leave"},{value:"personal",label:"Personal Leave"},{value:"maternity",label:"Maternity Leave"},{value:"paternity",label:"Paternity Leave"},{value:"unpaid",label:"Unpaid Leave"},{value:"other",label:"Other"}],I$=[{value:"pending",label:"Pending",color:"yellow"},{value:"approved",label:"Approved",color:"green"},{value:"rejected",label:"Rejected",color:"red"}],C$=[{value:"pending",label:"Pending",color:"gray"},{value:"in_progress",label:"In Progress",color:"blue"},{value:"completed",label:"Completed",color:"green"}],k$=[{value:"CL",label:"Casual Leave",color:"blue"},{value:"PL",label:"Privilege Leave",color:"green"},{value:"SL",label:"Sick Leave",color:"orange"},{value:"COMP_OFF",label:"Compensatory Off",color:"purple"}],P$=[{value:"monthly",label:"Monthly"},{value:"yearly",label:"Yearly (Full credit at start)"},{value:"none",label:"No Accrual (Manual only)"}],O$=[{value:"none",label:"No Carry Forward"},{value:"limited",label:"Limited (with max limit)"},{value:"unlimited",label:"Unlimited Carry Forward"}],N$=[{value:"80C",label:"Section 80C",limit:15e4,description:"PPF, ELSS, LIC, NSC, Tax Saver FD, etc."},{value:"80CCD",label:"Section 80CCD(1B)",limit:5e4,description:"Additional NPS contribution"},{value:"80D",label:"Section 80D",limit:1e5,description:"Health Insurance Premium"},{value:"80E",label:"Section 80E",limit:null,description:"Education Loan Interest"},{value:"80G",label:"Section 80G",limit:null,description:"Donations to approved funds"},{value:"HRA",label:"House Rent Allowance",limit:null,description:"Rent paid for accommodation"},{value:"LTA",label:"Leave Travel Allowance",limit:null,description:"Travel expenses for leave"},{value:"OTHER",label:"Other Deductions",limit:null,description:"Any other eligible deductions"}],j$=[{value:"draft",label:"Draft",color:"gray"},{value:"submitted",label:"Submitted",color:"blue"},{value:"verified",label:"Verified",color:"green"}],R$=["PPF (Public Provident Fund)","ELSS (Equity Linked Savings Scheme)","LIC Premium","NSC (National Savings Certificate)","Tax Saver Fixed Deposit","Sukanya Samriddhi Account","EPF (Employee Provident Fund)","Home Loan Principal","Tuition Fees","ULIP","Other 80C Investment"],D$=["Self & Family Health Insurance","Parents Health Insurance","Preventive Health Checkup"];var{Pool:L$}=_n;if(!process.env.DATABASE_URL)throw new Error("DATABASE_URL must be set. Did you forget to provision a database?");var q$=new L$({connectionString:process.env.DATABASE_URL}),T=Eu(q$,{schema:Bg});var zg=class{async getOrganizations(){return T.select().from($).orderBy(me($.createdAt))}async getOrganization(e){let[r]=await T.select().from($).where(I($.id,e));return r}async getOrganizationByCode(e){let[r]=await T.select().from($).where(I($.code,e));return r}async createOrganization(e){let r={...e,code:e.code?.toUpperCase().trim()||null},[n]=await T.insert($).values(r).returning();return n}async updateOrganization(e,r){let[n]=await T.update($).set(r).where(I($.id,e)).returning();return n}async updateOrganizationStatus(e,r){let[n]=await T.update($).set({isActive:r}).where(I($.id,e)).returning();return n}async getAppUserByEmail(e){let[r]=await T.select().from(ie).where(I(ie.email,e.toLowerCase()));return r}async getAppUserById(e){let[r]=await T.select().from(ie).where(I(ie.id,e));return r}async getAppUserByInviteToken(e){let[r]=await T.select().from(ie).where(Ae(I(ie.inviteToken,e),I(ie.isPending,!0)));return r}async getAppUsersByOrg(e){return T.select().from(ie).where(I(ie.organizationId,e))}async getAllAppUsers(){return T.select().from(ie)}async createAppUser(e){let[r]=await T.insert(ie).values(e).returning();return r}async updateAppUser(e,r){let[n]=await T.update(ie).set(r).where(I(ie.id,e)).returning();return n}async updateAppUserPassword(e,r){await T.update(ie).set({password:r}).where(I(ie.id,e))}async getEmployeesByOrg(e){return T.select().from(Y).where(I(Y.organizationId,e)).orderBy(Tn(Y.firstName))}async getEmployee(e){let[r]=await T.select().from(Y).where(I(Y.id,e));return r}async getEmployeeByEmail(e,r){let[n]=await T.select().from(Y).where(Ae(I(Y.organizationId,e),I(Y.email,r)));return n}async getEmployeeByCode(e,r){let[n]=await T.select().from(Y).where(Ae(I(Y.organizationId,e),I(Y.employeeCode,r)));return n}async createEmployee(e){let[r]=await T.insert(Y).values(e).returning();return r}async updateEmployee(e,r){let[n]=await T.update(Y).set(r).where(I(Y.id,e)).returning();return n}async getDocumentsByEmployee(e){return T.select().from(wr).where(I(wr.employeeId,e)).orderBy(me(wr.uploadedAt))}async getDocument(e){let[r]=await T.select().from(wr).where(I(wr.id,e));return r}async createDocument(e){let[r]=await T.insert(wr).values(e).returning();return r}async deleteDocument(e){await T.delete(wr).where(I(wr.id,e))}async getEmploymentHistory(e){return T.select().from(zr).where(I(zr.employeeId,e)).orderBy(me(zr.startDate))}async createEmploymentPeriod(e){let[r]=await T.insert(zr).values(e).returning();return r}async closeEmploymentPeriod(e,r,n){await T.update(zr).set({endDate:r,exitReason:n}).where(Ae(I(zr.employeeId,e),v`${zr.endDate} IS NULL`))}getMonthEndDate(e){let[r,n]=e.split("-").map(Number),a=new Date(r,n,0).getDate();return`${e}-${String(a).padStart(2,"0")}`}async getAttendanceByOrg(e,r){let n=`${r}-01`,a=this.getMonthEndDate(r);return T.select().from(Se).where(Ae(I(Se.organizationId,e),En(Se.date,n),Sn(Se.date,a)))}async getAttendanceByEmployee(e,r){if(r){let n=`${r}-01`,a=this.getMonthEndDate(r);return T.select().from(Se).where(Ae(I(Se.employeeId,e),En(Se.date,n),Sn(Se.date,a))).orderBy(me(Se.date))}return T.select().from(Se).where(I(Se.employeeId,e)).orderBy(me(Se.date))}async createOrUpdateAttendance(e){for(let r of e){let n=await T.select().from(Se).where(Ae(I(Se.employeeId,r.employeeId),I(Se.date,r.date)));n.length>0?await T.update(Se).set(r).where(I(Se.id,n[0].id)):await T.insert(Se).values(r)}}async getPayslipsByOrg(e){return T.select().from(st).where(I(st.organizationId,e)).orderBy(me(st.uploadedAt))}async getPayslipsByEmployee(e){return T.select().from(st).where(I(st.employeeId,e)).orderBy(me(st.year),me(st.month))}async getPayslip(e){let[r]=await T.select().from(st).where(I(st.id,e));return r}async createPayslip(e){let[r]=await T.insert(st).values(e).returning();return r}async deletePayslip(e){await T.delete(st).where(I(st.id,e))}async getHolidaysByOrg(e,r){let n=await T.select().from(Xe).where(I(Xe.organizationId,e)),a=await T.select().from(Xe).where(Ae(v`${Xe.organizationId} IS NULL`,Co(v`${Xe.industry} IS NULL`,r?I(Xe.industry,r):v`1=1`)));return[...n,...a].sort((i,s)=>new Date(i.date).getTime()-new Date(s.date).getTime())}async getDefaultHolidays(){return T.select().from(Xe).where(v`${Xe.organizationId} IS NULL`).orderBy(Tn(Xe.date))}async getUpcomingHolidays(e,r){let n=new Date().toISOString().split("T")[0];return(await this.getHolidaysByOrg(e,r)).filter(i=>i.date>=n)}async getHoliday(e){let[r]=await T.select().from(Xe).where(I(Xe.id,e));return r}async createHoliday(e){let[r]=await T.insert(Xe).values(e).returning();return r}async updateHoliday(e,r){let[n]=await T.update(Xe).set(r).where(I(Xe.id,e)).returning();return n}async deleteHoliday(e){await T.delete(Xe).where(I(Xe.id,e))}async getLeaveRequestsByOrg(e){return T.select().from(Je).where(I(Je.organizationId,e)).orderBy(me(Je.createdAt))}async getLeaveRequestsByEmployee(e){return T.select().from(Je).where(I(Je.employeeId,e)).orderBy(me(Je.createdAt))}async getPendingLeaveRequests(e){return T.select().from(Je).where(Ae(I(Je.organizationId,e),I(Je.status,"pending"))).orderBy(me(Je.createdAt))}async getLeaveRequest(e){let[r]=await T.select().from(Je).where(I(Je.id,e));return r}async createLeaveRequest(e){let[r]=await T.insert(Je).values(e).returning();return r}async updateLeaveRequest(e,r){let[n]=await T.update(Je).set(r).where(I(Je.id,e)).returning();return n}async getOnboardingTasksByOrg(e){return T.select().from(Ve).where(I(Ve.organizationId,e)).orderBy(me(Ve.createdAt))}async getOnboardingTasksByEmployee(e){return T.select().from(Ve).where(I(Ve.employeeId,e)).orderBy(Tn(Ve.dueDate))}async getPendingOnboardingTasks(e){return T.select().from(Ve).where(Ae(I(Ve.organizationId,e),Co(I(Ve.status,"pending"),I(Ve.status,"in_progress")))).orderBy(Tn(Ve.dueDate))}async getOnboardingTask(e){let[r]=await T.select().from(Ve).where(I(Ve.id,e));return r}async createOnboardingTask(e){let[r]=await T.insert(Ve).values(e).returning();return r}async updateOnboardingTask(e,r){let[n]=await T.update(Ve).set(r).where(I(Ve.id,e)).returning();return n}async getNotificationsByUser(e){return T.select().from(ht).where(I(ht.userId,e)).orderBy(me(ht.createdAt))}async getUnreadNotifications(e){return T.select().from(ht).where(Ae(I(ht.userId,e),I(ht.isRead,!1))).orderBy(me(ht.createdAt))}async createNotification(e){let[r]=await T.insert(ht).values(e).returning();return r}async markNotificationRead(e){await T.update(ht).set({isRead:!0}).where(I(ht.id,e))}async markAllNotificationsRead(e){await T.update(ht).set({isRead:!0}).where(I(ht.userId,e))}async getSuperAdminStats(){let e=await T.select().from($),r=await T.select().from(Y),n={};return e.forEach(a=>{let i=a.industry||"other";n[i]=(n[i]||0)+1}),{totalOrganizations:e.length,activeOrganizations:e.filter(a=>a.isActive).length,totalEmployees:r.length,industriesBreakdown:n}}async getOrgStats(e){let r=await T.select().from(Y).where(I(Y.organizationId,e)),n=new Date().toISOString().split("T")[0],a=await T.select().from(Se).where(Ae(I(Se.organizationId,e),I(Se.date,n)));return{totalEmployees:r.length,activeEmployees:r.filter(i=>i.status==="active").length,exitedEmployees:r.filter(i=>i.status==="exited").length,presentToday:a.filter(i=>i.status==="present").length,absentToday:a.filter(i=>i.status==="absent").length,onLeaveToday:a.filter(i=>i.status==="leave").length}}async getEmployeeStats(e){let r=new Date,n=`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}`,a=await this.getAttendanceByEmployee(e,n),i=await this.getPayslipsByEmployee(e);return{presentThisMonth:a.filter(s=>s.status==="present").length,absentThisMonth:a.filter(s=>s.status==="absent").length,leaveThisMonth:a.filter(s=>s.status==="leave").length,totalPayslips:i.length}}async createPasswordResetRequest(e){let[r]=await T.insert(xt).values(e).returning();return r}async getPasswordResetRequestById(e){let[r]=await T.select().from(xt).where(I(xt.id,e));return r}async getPendingPasswordResetRequests(e){return e?T.select().from(xt).where(Ae(I(xt.organizationId,e),I(xt.status,"pending"))).orderBy(me(xt.createdAt)):T.select().from(xt).where(I(xt.status,"pending")).orderBy(me(xt.createdAt))}async completePasswordResetRequest(e,r){await T.update(xt).set({status:"completed",completedBy:r,completedAt:new Date}).where(I(xt.id,e))}async dismissPasswordResetRequest(e){await T.update(xt).set({status:"dismissed"}).where(I(xt.id,e))}async getLeavePoliciesByOrg(e){return T.select().from(Tt).where(I(Tt.organizationId,e)).orderBy(Tn(Tt.code))}async getLeavePolicy(e){let[r]=await T.select().from(Tt).where(I(Tt.id,e));return r}async createLeavePolicy(e){let[r]=await T.insert(Tt).values(e).returning();return r}async updateLeavePolicy(e,r){let[n]=await T.update(Tt).set(r).where(I(Tt.id,e)).returning();return n}async deleteLeavePolicy(e){await T.delete(Tt).where(I(Tt.id,e))}async getEmployeeLeaveBalances(e,r){return T.select().from(bt).where(Ae(I(bt.employeeId,e),I(bt.year,r)))}async getEmployeeLeaveBalance(e,r,n){let[a]=await T.select().from(bt).where(Ae(I(bt.employeeId,e),I(bt.policyId,r),I(bt.year,n)));return a}async getAllLeaveBalancesByOrg(e,r){return T.select().from(bt).where(Ae(I(bt.organizationId,e),I(bt.year,r)))}async createEmployeeLeaveBalance(e){let[r]=await T.insert(bt).values(e).returning();return r}async updateEmployeeLeaveBalance(e,r){let[n]=await T.update(bt).set(r).where(I(bt.id,e)).returning();return n}async initializeEmployeeBalances(e,r,n){let i=(await this.getLeavePoliciesByOrg(r)).filter(s=>s.isActive);for(let s of i)if(!await this.getEmployeeLeaveBalance(e,s.id,n)){let c=0;s.accrualMethod==="yearly"&&(c=s.annualQuota),await this.createEmployeeLeaveBalance({employeeId:e,policyId:s.id,organizationId:r,year:n,openingBalance:"0",accrued:String(c),used:"0",adjustment:"0",currentBalance:String(c)})}}async getLeaveTransactions(e){return T.select().from(Dt).where(I(Dt.balanceId,e)).orderBy(me(Dt.createdAt))}async getLeaveTransactionsByEmployee(e,r){if(r){let n=new Date(r,0,1),a=new Date(r+1,0,1);return T.select().from(Dt).where(Ae(I(Dt.employeeId,e),En(Dt.createdAt,n),Sn(Dt.createdAt,a))).orderBy(me(Dt.createdAt))}return T.select().from(Dt).where(I(Dt.employeeId,e)).orderBy(me(Dt.createdAt))}async createLeaveTransaction(e){let[r]=await T.insert(Dt).values(e).returning();return r}async getTimeEntriesByEmployee(e,r,n){return r&&n?T.select().from(ze).where(Ae(I(ze.employeeId,e),En(ze.date,r),Sn(ze.date,n))).orderBy(ze.entryTime):T.select().from(ze).where(I(ze.employeeId,e)).orderBy(me(ze.entryTime))}async getTimeEntriesByOrg(e,r,n){return r&&n?T.select().from(ze).where(Ae(I(ze.organizationId,e),En(ze.date,r),Sn(ze.date,n))).orderBy(ze.entryTime):T.select().from(ze).where(I(ze.organizationId,e)).orderBy(me(ze.entryTime))}async createTimeEntry(e){let[r]=await T.insert(ze).values(e).returning();return r}async getTodayTimeEntries(e){let r=new Date().toISOString().split("T")[0];return T.select().from(ze).where(Ae(I(ze.employeeId,e),I(ze.date,r))).orderBy(ze.entryTime)}async getCompOffGrantsByEmployee(e){return T.select().from(At).where(I(At.employeeId,e)).orderBy(me(At.createdAt))}async getCompOffGrantsByOrg(e){return T.select().from(At).where(I(At.organizationId,e)).orderBy(me(At.createdAt))}async getPendingCompOffGrants(e){return T.select().from(At).where(Ae(I(At.organizationId,e),I(At.isApplied,!1))).orderBy(me(At.createdAt))}async createCompOffGrant(e){let[r]=await T.insert(At).values(e).returning();return r}async applyCompOffGrant(e){let[r]=await T.update(At).set({isApplied:!0,appliedAt:new Date}).where(I(At.id,e)).returning();return r}async getTaxDeclarationsByEmployee(e){return T.select().from(ce).where(I(ce.employeeId,e)).orderBy(me(ce.financialYear))}async getTaxDeclarationsByOrg(e,r){return r?T.select().from(ce).where(Ae(I(ce.organizationId,e),I(ce.financialYear,r))).orderBy(me(ce.createdAt)):T.select().from(ce).where(I(ce.organizationId,e)).orderBy(me(ce.financialYear))}async getAllTaxDeclarations(e){return e?T.select().from(ce).where(I(ce.financialYear,e)).orderBy(me(ce.createdAt)):T.select().from(ce).orderBy(me(ce.financialYear))}async getTaxDeclaration(e){let[r]=await T.select().from(ce).where(I(ce.id,e));return r}async getTaxDeclarationByEmployeeAndYear(e,r){let[n]=await T.select().from(ce).where(Ae(I(ce.employeeId,e),I(ce.financialYear,r)));return n}async createTaxDeclaration(e){let[r]=await T.insert(ce).values(e).returning();return r}async updateTaxDeclaration(e,r){let[n]=await T.update(ce).set(r).where(I(ce.id,e)).returning();return n}async deleteTaxDeclaration(e){await T.delete(ce).where(I(ce.id,e))}async getTaxDeclarationItems(e){return T.select().from(gt).where(I(gt.declarationId,e)).orderBy(gt.category)}async getTaxDeclarationItem(e){let[r]=await T.select().from(gt).where(I(gt.id,e));return r}async createTaxDeclarationItem(e){let[r]=await T.insert(gt).values(e).returning();return r}async updateTaxDeclarationItem(e,r){let[n]=await T.update(gt).set(r).where(I(gt.id,e)).returning();return n}async deleteTaxDeclarationItem(e){await T.delete(gt).where(I(gt.id,e))}async deleteTaxDeclarationItemsByDeclaration(e){await T.delete(gt).where(I(gt.declarationId,e))}},y=new zg;var sy=Wt(Y6(),1);var r5=Wt(require("crypto"),1),ty=null;function JH(t){try{return crypto.getRandomValues(new Uint8Array(t))}catch{}try{return r5.default.randomBytes(t)}catch{}if(!ty)throw Error("Neither WebCryptoAPI nor a crypto module is available. Use bcrypt.setRandomFallback to set an alternative");return ty(t)}function XH(t){ty=t}function ny(t,e){if(t=t||ay,typeof t!="number")throw Error("Illegal arguments: "+typeof t+", "+typeof e);t<4?t=4:t>31&&(t=31);var r=[];return r.push("$2b$"),t<10&&r.push("0"),r.push(t.toString()),r.push("$"),r.push(Cu(JH(Fo),Fo)),r.join("")}function n5(t,e,r){if(typeof e=="function"&&(r=e,e=void 0),typeof t=="function"&&(r=t,t=void 0),typeof t>"u")t=ay;else if(typeof t!="number")throw Error("illegal arguments: "+typeof t);function n(a){_r(function(){try{a(null,ny(t))}catch(i){a(i)}})}if(r){if(typeof r!="function")throw Error("Illegal callback: "+typeof r);n(r)}else return new Promise(function(a,i){n(function(s,o){if(s){i(s);return}a(o)})})}function a5(t,e){if(typeof e>"u"&&(e=ay),typeof e=="number"&&(e=ny(e)),typeof t!="string"||typeof e!="string")throw Error("Illegal arguments: "+typeof t+", "+typeof e);return ry(t,e)}function i5(t,e,r,n){function a(i){typeof t=="string"&&typeof e=="number"?n5(e,function(s,o){ry(t,o,i,n)}):typeof t=="string"&&typeof e=="string"?ry(t,e,i,n):_r(i.bind(this,Error("Illegal arguments: "+typeof t+", "+typeof e)))}if(r){if(typeof r!="function")throw Error("Illegal callback: "+typeof r);a(r)}else return new Promise(function(i,s){a(function(o,c){if(o){s(o);return}i(c)})})}function s5(t,e){for(var r=t.length^e.length,n=0;n<t.length;++n)r|=t.charCodeAt(n)^e.charCodeAt(n);return r===0}function eQ(t,e){if(typeof t!="string"||typeof e!="string")throw Error("Illegal arguments: "+typeof t+", "+typeof e);return e.length!==60?!1:s5(a5(t,e.substring(0,e.length-31)),e)}function tQ(t,e,r,n){function a(i){if(typeof t!="string"||typeof e!="string"){_r(i.bind(this,Error("Illegal arguments: "+typeof t+", "+typeof e)));return}if(e.length!==60){_r(i.bind(this,null,!1));return}i5(t,e.substring(0,29),function(s,o){s?i(s):i(null,s5(o,e))},n)}if(r){if(typeof r!="function")throw Error("Illegal callback: "+typeof r);a(r)}else return new Promise(function(i,s){a(function(o,c){if(o){s(o);return}i(c)})})}function rQ(t){if(typeof t!="string")throw Error("Illegal arguments: "+typeof t);return parseInt(t.split("$")[2],10)}function nQ(t){if(typeof t!="string")throw Error("Illegal arguments: "+typeof t);if(t.length!==60)throw Error("Illegal hash length: "+t.length+" != 60");return t.substring(0,29)}function aQ(t){if(typeof t!="string")throw Error("Illegal arguments: "+typeof t);return o5(t)>72}var _r=typeof setImmediate=="function"?setImmediate:typeof scheduler=="object"&&typeof scheduler.postTask=="function"?scheduler.postTask.bind(scheduler):setTimeout;function o5(t){for(var e=0,r=0,n=0;n<t.length;++n)r=t.charCodeAt(n),r<128?e+=1:r<2048?e+=2:(r&64512)===55296&&(t.charCodeAt(n+1)&64512)===56320?(++n,e+=4):e+=3;return e}function iQ(t){for(var e=0,r,n,a=new Array(o5(t)),i=0,s=t.length;i<s;++i)r=t.charCodeAt(i),r<128?a[e++]=r:r<2048?(a[e++]=r>>6|192,a[e++]=r&63|128):(r&64512)===55296&&((n=t.charCodeAt(i+1))&64512)===56320?(r=65536+((r&1023)<<10)+(n&1023),++i,a[e++]=r>>18|240,a[e++]=r>>12&63|128,a[e++]=r>>6&63|128,a[e++]=r&63|128):(a[e++]=r>>12|224,a[e++]=r>>6&63|128,a[e++]=r&63|128);return a}var Bi="./ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),Cn=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,54,55,56,57,58,59,60,61,62,63,-1,-1,-1,-1,-1,-1,-1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,-1,-1,-1,-1,-1,-1,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,-1,-1,-1,-1,-1];function Cu(t,e){var r=0,n=[],a,i;if(e<=0||e>t.length)throw Error("Illegal len: "+e);for(;r<e;){if(a=t[r++]&255,n.push(Bi[a>>2&63]),a=(a&3)<<4,r>=e){n.push(Bi[a&63]);break}if(i=t[r++]&255,a|=i>>4&15,n.push(Bi[a&63]),a=(i&15)<<2,r>=e){n.push(Bi[a&63]);break}i=t[r++]&255,a|=i>>6&3,n.push(Bi[a&63]),n.push(Bi[i&63])}return n.join("")}function c5(t,e){var r=0,n=t.length,a=0,i=[],s,o,c,l,u,p;if(e<=0)throw Error("Illegal len: "+e);for(;r<n-1&&a<e&&(p=t.charCodeAt(r++),s=p<Cn.length?Cn[p]:-1,p=t.charCodeAt(r++),o=p<Cn.length?Cn[p]:-1,!(s==-1||o==-1||(u=s<<2>>>0,u|=(o&48)>>4,i.push(String.fromCharCode(u)),++a>=e||r>=n)||(p=t.charCodeAt(r++),c=p<Cn.length?Cn[p]:-1,c==-1)||(u=(o&15)<<4>>>0,u|=(c&60)>>2,i.push(String.fromCharCode(u)),++a>=e||r>=n)));)p=t.charCodeAt(r++),l=p<Cn.length?Cn[p]:-1,u=(c&3)<<6>>>0,u|=l,i.push(String.fromCharCode(u)),++a;var d=[];for(r=0;r<a;r++)d.push(i[r].charCodeAt(0));return d}var Fo=16,ay=10,sQ=16,oQ=100,J6=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731],X6=[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946,1266315497,3048417604,3681880366,3289982499,290971e4,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055,3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504,976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409e3,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462],l5=[1332899944,1700884034,1701343084,1684370003,1668446532,1869963892];function $o(t,e,r,n){var a,i=t[e],s=t[e+1];return i^=r[0],a=n[i>>>24],a+=n[256|i>>16&255],a^=n[512|i>>8&255],a+=n[768|i&255],s^=a^r[1],a=n[s>>>24],a+=n[256|s>>16&255],a^=n[512|s>>8&255],a+=n[768|s&255],i^=a^r[2],a=n[i>>>24],a+=n[256|i>>16&255],a^=n[512|i>>8&255],a+=n[768|i&255],s^=a^r[3],a=n[s>>>24],a+=n[256|s>>16&255],a^=n[512|s>>8&255],a+=n[768|s&255],i^=a^r[4],a=n[i>>>24],a+=n[256|i>>16&255],a^=n[512|i>>8&255],a+=n[768|i&255],s^=a^r[5],a=n[s>>>24],a+=n[256|s>>16&255],a^=n[512|s>>8&255],a+=n[768|s&255],i^=a^r[6],a=n[i>>>24],a+=n[256|i>>16&255],a^=n[512|i>>8&255],a+=n[768|i&255],s^=a^r[7],a=n[s>>>24],a+=n[256|s>>16&255],a^=n[512|s>>8&255],a+=n[768|s&255],i^=a^r[8],a=n[i>>>24],a+=n[256|i>>16&255],a^=n[512|i>>8&255],a+=n[768|i&255],s^=a^r[9],a=n[s>>>24],a+=n[256|s>>16&255],a^=n[512|s>>8&255],a+=n[768|s&255],i^=a^r[10],a=n[i>>>24],a+=n[256|i>>16&255],a^=n[512|i>>8&255],a+=n[768|i&255],s^=a^r[11],a=n[s>>>24],a+=n[256|s>>16&255],a^=n[512|s>>8&255],a+=n[768|s&255],i^=a^r[12],a=n[i>>>24],a+=n[256|i>>16&255],a^=n[512|i>>8&255],a+=n[768|i&255],s^=a^r[13],a=n[s>>>24],a+=n[256|s>>16&255],a^=n[512|s>>8&255],a+=n[768|s&255],i^=a^r[14],a=n[i>>>24],a+=n[256|i>>16&255],a^=n[512|i>>8&255],a+=n[768|i&255],s^=a^r[15],a=n[s>>>24],a+=n[256|s>>16&255],a^=n[512|s>>8&255],a+=n[768|s&255],i^=a^r[16],t[e]=s^r[sQ+1],t[e+1]=i,t}function zi(t,e){for(var r=0,n=0;r<4;++r)n=n<<8|t[e]&255,e=(e+1)%t.length;return{key:n,offp:e}}function e5(t,e,r){for(var n=0,a=[0,0],i=e.length,s=r.length,o,c=0;c<i;c++)o=zi(t,n),n=o.offp,e[c]=e[c]^o.key;for(c=0;c<i;c+=2)a=$o(a,0,e,r),e[c]=a[0],e[c+1]=a[1];for(c=0;c<s;c+=2)a=$o(a,0,e,r),r[c]=a[0],r[c+1]=a[1]}function cQ(t,e,r,n){for(var a=0,i=[0,0],s=r.length,o=n.length,c,l=0;l<s;l++)c=zi(e,a),a=c.offp,r[l]=r[l]^c.key;for(a=0,l=0;l<s;l+=2)c=zi(t,a),a=c.offp,i[0]^=c.key,c=zi(t,a),a=c.offp,i[1]^=c.key,i=$o(i,0,r,n),r[l]=i[0],r[l+1]=i[1];for(l=0;l<o;l+=2)c=zi(t,a),a=c.offp,i[0]^=c.key,c=zi(t,a),a=c.offp,i[1]^=c.key,i=$o(i,0,r,n),n[l]=i[0],n[l+1]=i[1]}function t5(t,e,r,n,a){var i=l5.slice(),s=i.length,o;if(r<4||r>31)if(o=Error("Illegal number of rounds (4-31): "+r),n){_r(n.bind(this,o));return}else throw o;if(e.length!==Fo)if(o=Error("Illegal salt length: "+e.length+" != "+Fo),n){_r(n.bind(this,o));return}else throw o;r=1<<r>>>0;var c,l,u=0,p;typeof Int32Array=="function"?(c=new Int32Array(J6),l=new Int32Array(X6)):(c=J6.slice(),l=X6.slice()),cQ(e,t,c,l);function d(){if(a&&a(u/r),u<r)for(var m=Date.now();u<r&&(u=u+1,e5(t,c,l),e5(e,c,l),!(Date.now()-m>oQ)););else{for(u=0;u<64;u++)for(p=0;p<s>>1;p++)$o(i,p<<1,c,l);var h=[];for(u=0;u<s;u++)h.push((i[u]>>24&255)>>>0),h.push((i[u]>>16&255)>>>0),h.push((i[u]>>8&255)>>>0),h.push((i[u]&255)>>>0);if(n){n(null,h);return}else return h}n&&_r(d)}if(typeof n<"u")d();else for(var f;;)if(typeof(f=d())<"u")return f||[]}function ry(t,e,r,n){var a;if(typeof t!="string"||typeof e!="string")if(a=Error("Invalid string / salt: Not a string"),r){_r(r.bind(this,a));return}else throw a;var i,s;if(e.charAt(0)!=="$"||e.charAt(1)!=="2")if(a=Error("Invalid salt version: "+e.substring(0,2)),r){_r(r.bind(this,a));return}else throw a;if(e.charAt(2)==="$")i="\0",s=3;else{if(i=e.charAt(2),i!=="a"&&i!=="b"&&i!=="y"||e.charAt(3)!=="$")if(a=Error("Invalid salt revision: "+e.substring(2,4)),r){_r(r.bind(this,a));return}else throw a;s=4}if(e.charAt(s+2)>"$")if(a=Error("Missing salt rounds"),r){_r(r.bind(this,a));return}else throw a;var o=parseInt(e.substring(s,s+1),10)*10,c=parseInt(e.substring(s+1,s+2),10),l=o+c,u=e.substring(s+3,s+25);t+=i>="a"?"\0":"";var p=iQ(t),d=c5(u,Fo);function f(m){var h=[];return h.push("$2"),i>="a"&&h.push(i),h.push("$"),l<10&&h.push("0"),h.push(l.toString()),h.push("$"),h.push(Cu(d,d.length)),h.push(Cu(m,l5.length*4-1)),h.join("")}if(typeof r>"u")return f(t5(p,d,l));t5(p,d,l,function(m,h){m?r(m,null):r(null,f(h))},n)}function lQ(t,e){return Cu(t,e)}function uQ(t,e){return c5(t,e)}var iy={setRandomFallback:XH,genSaltSync:ny,genSalt:n5,hashSync:a5,hash:i5,compareSync:eQ,compare:tQ,getRounds:rQ,getSalt:nQ,truncates:aQ,encodeBase64:lQ,decodeBase64:uQ};var m5=Wt(f5(),1);var dQ=(0,m5.default)(sy.default);async function h5(t){let e=process.env.SESSION_SECRET;if(!e)throw new Error("SESSION_SECRET environment variable is required");let r=new k8({connectionString:process.env.DATABASE_URL});t.use((0,sy.default)({store:new dQ({pool:r,tableName:"sessions",createTableIfMissing:!1}),secret:e,resave:!1,saveUninitialized:!1,cookie:{secure:!0,httpOnly:!0,maxAge:10080*60*1e3,sameSite:"lax"}}))}async function kn(t){return iy.hash(t,12)}async function oy(t,e){return iy.compare(t,e)}function g5(t){t.post("/api/auth/register",async(e,r)=>{try{let{email:n,password:a,firstName:i,lastName:s}=e.body;if(!n||!a)return r.status(400).json({message:"Email and password are required"});let o=await y.getAppUserByEmail(n);if(o&&!o.isPending)return r.status(400).json({message:"User already exists"});let c=await kn(a),l;if(o&&o.isPending)l=await y.updateAppUser(o.id,{password:c,firstName:i,lastName:s,isPending:!1,inviteToken:null});else{let p=(await y.getAllAppUsers()).length===0?"super_admin":"employee";l=await y.createAppUser({email:n.toLowerCase(),password:c,firstName:i,lastName:s,role:p,isActive:!0,isPending:!1})}e.session.userId=l.id,r.json({user:{id:l.id,email:l.email,firstName:l.firstName,lastName:l.lastName,role:l.role,organizationId:l.organizationId}})}catch(n){console.error("Registration error:",n),r.status(500).json({message:"Registration failed"})}}),t.post("/api/auth/login",async(e,r)=>{try{let{email:n,password:a}=e.body;if(!n||!a)return r.status(400).json({message:"Email and password are required"});let i=await y.getAppUserByEmail(n.toLowerCase());if(!i||i.isPending)return r.status(401).json({message:"Invalid credentials"});if(!await oy(a,i.password))return r.status(401).json({message:"Invalid credentials"});if(!i.isActive)return r.status(401).json({message:"Account is disabled"});e.session.userId=i.id;let o=null;i.organizationId&&(o=await y.getOrganization(i.organizationId)),r.json({user:{id:i.id,email:i.email,firstName:i.firstName,lastName:i.lastName,role:i.role,organizationId:i.organizationId},organization:o})}catch(n){console.error("Login error:",n),r.status(500).json({message:"Login failed"})}}),t.post("/api/auth/logout",(e,r)=>{e.session.destroy(n=>{if(n)return r.status(500).json({message:"Logout failed"});r.clearCookie("connect.sid"),r.json({message:"Logged out successfully"})})}),t.get("/api/auth/user",async(e,r)=>{let n=e.session?.userId;if(!n)return r.json({user:null});try{let a=await y.getAppUserById(n);if(!a||!a.isActive)return r.json({user:null});let i=null;a.organizationId&&(i=await y.getOrganization(a.organizationId)),r.json({user:{id:a.id,email:a.email,firstName:a.firstName,lastName:a.lastName,role:a.role,organizationId:a.organizationId},organization:i})}catch(a){console.error("Get user error:",a),r.json({user:null})}}),t.post("/api/auth/accept-invite",async(e,r)=>{try{let{token:n,password:a,firstName:i,lastName:s}=e.body;if(!n||!a)return r.status(400).json({message:"Token and password are required"});let o=await y.getAppUserByInviteToken(n);if(!o)return r.status(400).json({message:"Invalid or expired invite token"});let c=await kn(a),l=await y.updateAppUser(o.id,{password:c,firstName:i,lastName:s,isPending:!1,inviteToken:null});e.session.userId=l.id,r.json({user:{id:l.id,email:l.email,firstName:l.firstName,lastName:l.lastName,role:l.role,organizationId:l.organizationId}})}catch(n){console.error("Accept invite error:",n),r.status(500).json({message:"Failed to accept invite"})}})}async function y5(t,e,r){let n=t.session?.userId;if(!n){r();return}try{let a=await y.getAppUserById(n);if(a&&a.isActive){let i=null;a.organizationId&&(i=await y.getOrganization(a.organizationId)),t.appUser={...a,organization:i}}}catch(a){console.error("Error in appUserMiddleware:",a)}r()}var b5={legalName:J.string().nullable().optional().transform(t=>t||null),website:J.string().nullable().optional().transform(t=>t||null),gstNumber:J.string().nullable().optional().transform(t=>t&&t.toUpperCase().trim()||null),panNumber:J.string().nullable().optional().transform(t=>t&&t.toUpperCase().trim()||null),tanNumber:J.string().nullable().optional().transform(t=>t&&t.toUpperCase().trim()||null),cinNumber:J.string().nullable().optional().transform(t=>t?.trim()||null),udyamNumber:J.string().nullable().optional().transform(t=>t?.trim()||null)},fQ=J.object({name:J.string().min(2),code:J.string().min(2).max(10).regex(/^[A-Z0-9]+$/,"Code must be uppercase letters and numbers only"),industry:J.string().min(1),address:J.string().nullable().optional().transform(t=>t||null),phone:J.string().nullable().optional().transform(t=>t||null),email:J.string().email().nullable().optional().or(J.literal("")).transform(t=>t||null),...b5,admin:J.object({email:J.string().email(),password:J.string().min(8),firstName:J.string().min(1),lastName:J.string().min(1)})}),mQ=J.object({name:J.string().min(2),industry:J.string().min(1),address:J.string().nullable().optional().transform(t=>t||null),phone:J.string().nullable().optional().transform(t=>t||null),email:J.string().email().nullable().optional().or(J.literal("")).transform(t=>t||null),...b5});function v5(){return x5.default.randomBytes(32).toString("hex")}var hQ=(0,Ho.default)({storage:Ho.default.diskStorage({destination:(t,e,r)=>{let n=Qo.default.join(process.cwd(),"uploads","payslips");Jr.default.existsSync(n)||Jr.default.mkdirSync(n,{recursive:!0}),r(null,n)},filename:(t,e,r)=>{let n=Date.now()+"-"+Math.round(Math.random()*1e9);r(null,n+"-"+e.originalname)}}),limits:{fileSize:10*1024*1024},fileFilter:(t,e,r)=>{let n=[".pdf",".doc",".docx"],a=Qo.default.extname(e.originalname).toLowerCase();n.includes(a)?r(null,!0):r(new Error("Only PDF and DOC files are allowed"))}}),gQ=(0,Ho.default)({storage:Ho.default.diskStorage({destination:(t,e,r)=>{let n=t.params.id,a=Qo.default.join(process.cwd(),"uploads","documents",n);Jr.default.existsSync(a)||Jr.default.mkdirSync(a,{recursive:!0}),r(null,a)},filename:(t,e,r)=>{let n=Date.now()+"-"+Math.round(Math.random()*1e9);r(null,n+"-"+e.originalname)}}),limits:{fileSize:10*1024*1024},fileFilter:(t,e,r)=>{let n=[".pdf",".doc",".docx",".jpg",".jpeg",".png"],a=Qo.default.extname(e.originalname).toLowerCase();n.includes(a)?r(null,!0):r(new Error("Only PDF, DOC, and image files are allowed"))}});function A(t,e,r){if(!t.appUser)return e.status(401).json({message:"Unauthorized"});r()}function De(t,e,r){if(!t.appUser||t.appUser.role!=="super_admin")return e.status(403).json({message:"Forbidden - Super Admin required"});r()}function G(t,e,r){if(!t.appUser||t.appUser.role!=="org_admin"&&t.appUser.role!=="super_admin")return e.status(403).json({message:"Forbidden - Org Admin required"});r()}function he(t,e,r){if(!t.appUser||!t.appUser.organizationId)return e.status(403).json({message:"Forbidden - Organization membership required"});r()}async function w5(t,e){await h5(e),g5(e),e.use(y5),e.get("/api/user/context",A,async(i,s)=>{s.json({appUser:i.appUser,organization:i.appUser?.organization||null})}),e.post("/api/user/change-password",A,async(i,s)=>{try{let{currentPassword:o,newPassword:c}=i.body;if(!o||!c)return s.status(400).json({message:"Current password and new password are required"});if(c.length<8)return s.status(400).json({message:"New password must be at least 8 characters"});let l=await y.getAppUserById(i.appUser.id);if(!l)return s.status(404).json({message:"User not found"});if(!await oy(o,l.password))return s.status(401).json({message:"Current password is incorrect"});let p=await kn(c);await y.updateAppUserPassword(l.id,p),s.json({message:"Password changed successfully"})}catch(o){s.status(500).json({message:o.message})}}),e.post("/api/admin/reset-password/:userId",A,De,async(i,s)=>{try{let{newPassword:o}=i.body;if(!o||o.length<8)return s.status(400).json({message:"New password must be at least 8 characters"});let c=await y.getAppUserById(i.params.userId);if(!c)return s.status(404).json({message:"User not found"});if(c.role==="super_admin")return s.status(403).json({message:"Cannot reset super admin password through this endpoint"});let l=await kn(o);await y.updateAppUserPassword(c.id,l),s.json({message:"Password reset successfully"})}catch(o){s.status(500).json({message:o.message})}}),e.post("/api/password-reset-request",async(i,s)=>{try{let{email:o}=i.body;if(!o)return s.status(400).json({message:"Email is required"});let c=await y.getAppUserByEmail(o);if(!c)return s.json({message:"If an account with this email exists, your request has been submitted to the administrator."});await y.createPasswordResetRequest({email:o,organizationId:c.organizationId||void 0,status:"pending"}),s.json({message:"Your password reset request has been submitted. An administrator will review it shortly."})}catch(o){s.status(500).json({message:o.message})}}),e.get("/api/admin/password-reset-requests",A,De,async(i,s)=>{try{let o=await y.getPendingPasswordResetRequests();s.json(o)}catch(o){s.status(500).json({message:o.message})}}),e.get("/api/org/password-reset-requests",A,G,async(i,s)=>{try{let o=await y.getPendingPasswordResetRequests(i.appUser.organizationId);s.json(o)}catch(o){s.status(500).json({message:o.message})}}),e.post("/api/password-reset-requests/:id/complete",A,async(i,s)=>{try{if(i.appUser.role!=="super_admin"&&i.appUser.role!=="org_admin")return s.status(403).json({message:"Access denied"});if(i.appUser.role==="org_admin"){let o=await y.getPasswordResetRequestById(i.params.id);if(!o||o.organizationId!==i.appUser.organizationId)return s.status(403).json({message:"Access denied"})}await y.completePasswordResetRequest(i.params.id,i.appUser.id),s.json({message:"Request marked as completed"})}catch(o){s.status(500).json({message:o.message})}}),e.post("/api/password-reset-requests/:id/dismiss",A,async(i,s)=>{try{if(i.appUser.role!=="super_admin"&&i.appUser.role!=="org_admin")return s.status(403).json({message:"Access denied"});if(i.appUser.role==="org_admin"){let o=await y.getPasswordResetRequestById(i.params.id);if(!o||o.organizationId!==i.appUser.organizationId)return s.status(403).json({message:"Access denied"})}await y.dismissPasswordResetRequest(i.params.id),s.json({message:"Request dismissed"})}catch(o){s.status(500).json({message:o.message})}}),e.get("/api/invite/check",async(i,s)=>{try{let o=i.query.token;if(!o)return s.status(400).json({message:"Token is required"});let c=await y.getAppUserByInviteToken(o);if(!c||!c.isPending)return s.status(404).json({message:"Invalid or expired invitation"});s.json({email:c.email,role:c.role})}catch(o){s.status(500).json({message:o.message})}}),e.get("/api/admin/stats",A,De,async(i,s)=>{try{let o=await y.getSuperAdminStats();s.json(o)}catch(o){s.status(500).json({message:o.message})}}),e.get("/api/organizations",A,De,async(i,s)=>{try{let o=await y.getOrganizations();s.json(o)}catch(o){s.status(500).json({message:o.message})}}),e.post("/api/organizations",A,De,async(i,s)=>{try{let o=fQ.safeParse(i.body);if(!o.success)return s.status(400).json({message:"Invalid request data",errors:o.error.flatten().fieldErrors});let{admin:c,...l}=o.data;if(await y.getOrganizationByCode(l.code))return s.status(400).json({message:"An organization with this code already exists"});if(await y.getAppUserByEmail(c.email))return s.status(400).json({message:"A user with this email already exists"});let d=await y.createOrganization(l),f=await kn(c.password);await y.createAppUser({email:c.email.toLowerCase(),password:f,firstName:c.firstName,lastName:c.lastName,organizationId:d.id,role:"org_admin",isActive:!0,isPending:!1}),s.status(201).json(d)}catch(o){s.status(500).json({message:o.message})}}),e.patch("/api/organizations/:id",A,De,async(i,s)=>{try{let o=mQ.safeParse(i.body);if(!o.success)return s.status(400).json({message:"Invalid request data",errors:o.error.flatten().fieldErrors});let c=await y.updateOrganization(i.params.id,o.data);if(!c)return s.status(404).json({message:"Organization not found"});s.json(c)}catch(o){s.status(500).json({message:o.message})}}),e.patch("/api/organizations/:id/status",A,De,async(i,s)=>{try{let{isActive:o}=i.body;if(typeof o!="boolean")return s.status(400).json({message:"isActive must be a boolean"});let c=await y.updateOrganizationStatus(i.params.id,o);if(!c)return s.status(404).json({message:"Organization not found"});s.json(c)}catch(o){s.status(500).json({message:o.message})}}),e.post("/api/org-admins",A,De,async(i,s)=>{try{let{organizationId:o,email:c,firstName:l,lastName:u,password:p}=i.body;if(!c||!o)return s.status(400).json({message:"Email and organization are required"});if(!p||p.length<8)return s.status(400).json({message:"Password must be at least 8 characters"});if(await y.getAppUserByEmail(c))return s.status(400).json({message:"A user or invitation already exists for this email"});let f=await kn(p),m=await y.createAppUser({email:c.toLowerCase(),password:f,firstName:l,lastName:u,isPending:!1,organizationId:o,role:"org_admin",isActive:!0}),{password:h,...b}=m;s.status(201).json(b)}catch(o){s.status(500).json({message:o.message})}}),e.get("/api/org-admins/:organizationId",A,De,async(i,s)=>{try{let l=(await y.getAppUsersByOrg(i.params.organizationId)).filter(u=>u.role==="org_admin").map(({password:u,...p})=>p);s.json(l)}catch(o){s.status(500).json({message:o.message})}}),e.patch("/api/org-admins/:id",A,De,async(i,s)=>{try{let{isActive:o}=i.body;if(typeof o!="boolean")return s.status(400).json({message:"isActive must be a boolean"});let c=await y.getAppUserById(i.params.id);if(!c||c.role!=="org_admin")return s.status(404).json({message:"Org admin not found"});let l=await y.updateAppUser(i.params.id,{isActive:o});if(!l)return s.status(404).json({message:"Failed to update"});let{password:u,...p}=l;s.json(p)}catch(o){s.status(500).json({message:o.message})}}),e.get("/api/admin/holidays",A,De,async(i,s)=>{try{let o=await y.getDefaultHolidays();s.json(o)}catch(o){s.status(500).json({message:o.message})}}),e.post("/api/admin/holidays",A,De,async(i,s)=>{try{let o=await y.createHoliday({...i.body,organizationId:null,isCustom:!1});s.status(201).json(o)}catch(o){s.status(500).json({message:o.message})}}),e.patch("/api/admin/holidays/:id",A,De,async(i,s)=>{try{let o=await y.updateHoliday(i.params.id,i.body);if(!o)return s.status(404).json({message:"Holiday not found"});s.json(o)}catch(o){s.status(500).json({message:o.message})}}),e.delete("/api/admin/holidays/:id",A,De,async(i,s)=>{try{await y.deleteHoliday(i.params.id),s.status(204).send()}catch(o){s.status(500).json({message:o.message})}}),e.get("/api/super-admin/employees",A,De,async(i,s)=>{try{let o=i.query.organizationId;if(!o)return s.status(400).json({message:"Organization ID is required"});let c=await y.getEmployeesByOrg(o);s.json(c)}catch(o){s.status(500).json({message:o.message})}}),e.post("/api/super-admin/employees/bulk",A,De,async(i,s)=>{try{let{organizationId:o,employees:c}=i.body;if(!o)return s.status(400).json({message:"Organization ID is required"});if(!Array.isArray(c)||c.length===0)return s.status(400).json({message:"No employee data provided"});let l={success:0,errors:[]},u=[];for(let p=0;p<c.length;p++){let d=c[p];try{if(!d.employeeCode||!d.firstName||!d.lastName||!d.email||!d.dateOfJoining){l.errors.push({row:p+1,message:"Missing required fields (employeeCode, firstName, lastName, email, dateOfJoining)"});continue}if(await y.getEmployeeByCode(o,d.employeeCode)){l.errors.push({row:p+1,message:`Employee with code ${d.employeeCode} already exists`});continue}if(await y.getEmployeeByEmail(o,d.email)){l.errors.push({row:p+1,message:`Employee with email ${d.email} already exists`});continue}let h=await y.createEmployee({employeeCode:d.employeeCode,firstName:d.firstName,lastName:d.lastName,email:d.email,phone:d.phone||null,department:d.department||null,designation:d.designation||null,dateOfJoining:d.dateOfJoining,salary:d.salary?parseInt(d.salary):null,address:d.address||null,emergencyContact:d.emergencyContact||null,organizationId:o});await y.createEmploymentPeriod({employeeId:h.id,organizationId:h.organizationId,startDate:h.dateOfJoining}),u.push({row:p+1,employeeCode:h.employeeCode,email:h.email}),l.success++}catch(f){l.errors.push({row:p+1,message:f.message})}}s.json({...l,createdEmployees:u})}catch(o){s.status(500).json({message:o.message})}}),e.get("/api/super-admin/attendance",A,De,async(i,s)=>{try{let o=i.query.organizationId,c=i.query.month;if(!o)return s.status(400).json({message:"Organization ID is required"});let l=await y.getAttendanceByOrg(o,c);s.json(l)}catch(o){s.status(500).json({message:o.message})}}),e.post("/api/super-admin/attendance/bulk",A,De,async(i,s)=>{try{let{records:o}=i.body;if(!o||!Array.isArray(o))return s.status(400).json({message:"Records array is required"});await y.createOrUpdateAttendance(o),s.json({message:"Attendance updated successfully"})}catch(o){s.status(500).json({message:o.message})}}),e.get("/api/super-admin/payslips",A,De,async(i,s)=>{try{let o=i.query.organizationId;if(!o)return s.status(400).json({message:"Organization ID is required"});let c=await y.getPayslipsByOrg(o);s.json(c)}catch(o){s.status(500).json({message:o.message})}}),e.get("/api/super-admin/holidays",A,De,async(i,s)=>{try{let o=i.query.organizationId;if(!o)return s.status(400).json({message:"Organization ID is required"});let c=await y.getOrganization(o),l=await y.getHolidaysByOrg(o,c?.industry);s.json(l)}catch(o){s.status(500).json({message:o.message})}}),e.post("/api/super-admin/holidays",A,De,async(i,s)=>{try{let{organizationId:o,name:c,date:l,isNational:u}=i.body;if(!o)return s.status(400).json({message:"Organization ID is required"});let p=await y.createHoliday({organizationId:o,name:c,date:l,isNational:u||!1,isCustom:!0});s.status(201).json(p)}catch(o){s.status(500).json({message:o.message})}}),e.patch("/api/super-admin/holidays/:id",A,De,async(i,s)=>{try{let o=await y.updateHoliday(i.params.id,i.body);s.json(o)}catch(o){s.status(500).json({message:o.message})}}),e.delete("/api/super-admin/holidays/:id",A,De,async(i,s)=>{try{await y.deleteHoliday(i.params.id),s.json({message:"Holiday deleted successfully"})}catch(o){s.status(500).json({message:o.message})}}),e.get("/api/super-admin/export/:type",A,De,async(i,s)=>{try{let o=i.query.organizationId,c=i.params.type;if(!o)return s.status(400).json({message:"Organization ID is required"});let l=await y.getOrganization(o);if(!l)return s.status(404).json({message:"Organization not found"});let u=w=>w==null?"":w instanceof Date||typeof w=="object"&&w.toISOString?w.toISOString().split("T")[0]:String(w),p=w=>{let _=u(w);return _.includes(",")||_.includes('"')||_.includes(`
		                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          

Error: DATABASE_URL must be set. Did you forget to provision a database?
    at Object.<anonymous> (/Users/prasanthdusi/HRApp/dist/index.cjs:78:59667)
    at Module._compile (node:internal/modules/cjs/loader:1739:14)
    at Object..js (node:internal/modules/cjs/loader:1904:10)
    at Module.load (node:internal/modules/cjs/loader:1473:32)
    at Function._load (node:internal/modules/cjs/loader:1285:12)
    at TracingChannel.traceSync (node:diagnostics_channel:322:14)
    at wrapModuleLoad (node:internal/modules/cjs/loader:234:24)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:151:5)
    at node:internal/main/run_main_module:33:47

Node.js v23.6.0
prasanthdusi@Prasanths-MacBook-Pro HRApp % 